# アンケート新規作成・編集ページ仕様書

## 1. 概要

本ドキュメントは、アンケート新規作成・編集ページの画面仕様と機能要件を定義する。
このページでは、ユーザーが新しいアンケートを作成し、既存のアンケートを編集するための各種設定を行う。

## 2. 画面レイアウト

画面は主に3つのエリアで構成される。

- **ヘッダー:** 全ページ共通のヘッダー。ブランドロゴ、ユーザー情報が表示される。
- **サイドバー:** 全ページ共通のナビゲーションメニュー。
- **メインコンテンツ:** アンケート作成・編集フォームが配置される主要な作業エリア。

## 3. 入力項目

メインコンテンツは、以下のセクションに分かれている。

### 3.1. 基本情報

アンケートの基本的な情報を設定する。

| 項目名 | ID | タイプ | 必須 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| アンケート名（社内管理用） | `surveyName` | テキスト入力 | ✔ | ユーザーが社内で管理するためのアンケート名。 |
| 表示タイトル（回答者向け）| `displayTitle` | テキスト入力 | ✔ | 回答者がアンケートページで目にするタイトル。 |
| 説明 | `description` | テキストエリア | | アンケートの説明文。回答者向けに表示される。 |
| 回答受付開始日 | `periodStart` | 日付選択 | ✔ | アンケートの回答受付を開始する日付。`flatpickr` を使用。 |
| 回答受付終了日 | `periodEnd` | 日付選択 | ✔ | アンケートの回答受付を終了する日付。`flatpickr` を使用。 |
| プラン | `plan` | プルダウン | ✔ | 利用するプランを選択。（Standard / Premium） |
| データ化完了希望日 | `deadline` | 日付選択 | | 名刺データのデータ化完了を希望する日付。`flatpickr` を使用。 |
| メモ | `memo` | テキストエリア | | 社内管理用の自由記述欄。 |

### 3.2. 名刺データ関連

名刺のデータ化に関する設定を行う。

| 項目名 | ID | タイプ | 必須 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| 名刺データ化 | `bizcardEnabled` | プルダウン | | 名刺のデータ化機能を利用するかどうか。（有効 / 無効） |
| 名刺データ化依頼枚数 | `bizcardRequest` | 数値入力 | | データ化を依頼する名刺のおおよその枚数。 |

### 3.3. お礼メール設定

回答者へのお礼メールの送信方法を設定する。

| 項目名 | ID | タイプ | 必須 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| お礼メール | `thankYouEmailSettings` | プルダウン | | 送信方法を選択。（自動送信 / 手動 / 設定なし） |

## 4. 質問グループ・質問項目設定

アンケートの質問項目を動的に追加・編集するエリア。

### 4.1. 質問グループ管理

- 複数の質問グループを作成可能。
- 各質問グループはアコーディオン形式で開閉可能。
- 質問グループの追加、複製、削除が可能。
- 質問グループはドラッグ＆ドロップで並べ替え可能（`Sortable.js` を使用）。

### 4.2. 質問項目管理

- 各質問グループ内に複数の質問項目を追加可能。
- 質問項目の複製、削除が可能。
- 質問項目はドラッグ＆ドロップで並べ替え可能（`Sortable.js` を使用）。並べ替え時に質問番号が自動で振り直される。

### 4.3. 質問タイプ

以下の質問タイプがサポートされている。フローティングメニューから選択し、質問項目として追加できる。

- フリーアンサー (`free_answer`)
- シングルアンサー (`single_answer`)
- マルチアンサー (`multi_answer`)
- 数値 (`number_answer`)
- マトリックス（単一選択） (`matrix_sa`)
- マトリックス（複数選択） (`matrix_ma`)
- 日付・時刻 (`date_time`)
- 手書き入力 (`handwriting`)

選択肢を持つ質問タイプ（単一選択、複数選択、マトリックスなど）では、選択肢の追加が可能。

## 5. UI/UX

### 5.1. フローティングナビゲーション（質問追加ボタン）

- 質問タイプ選択メニューを開くボタンはフローティング形式で表示され、ドラッグで画面上の任意の位置に移動可能。
- スクロール時にボタンのテキストラベルが自動的に隠れる。
- クリックとドラッグ操作を厳密に区別し、意図しないメニュー表示を防ぐ。
- メニューは画面外にはみ出さないように表示位置が調整される。
- スクロールまたはブラウザのリサイズ時に、開いているメニューは自動的に閉じる。

### 5.2. アウトラインマップ

- 画面右側にアウトラインマップが表示され、アンケートのセクション構造を一覧できる。
- ユーザーがスクロールすると、現在表示されているセクションに対応するアウトラインマップの項目がハイライトされる（スクロールスパイ機能）。

### 5.3. アコーディオン

- 質問グループはアコーディオン形式で開閉でき、コンテンツの整理と視認性向上に寄与する。

## 6. データ連携

- アンケートデータは `src/services/surveyService.js` を介して取得・更新される。
- アンケートデータの構造は `data/sample_survey.json` に定義されており、`surveyId`, `name`, `displayTitle`, `description`, `periodStart`, `periodEnd`, `plan`, `deadline`, `memo`, `questionGroups` (質問グループと質問項目を含む) などのフィールドを持つ。

## 7. モーダル連携

以下のモーダルがページから開かれる。

- アカウント情報モーダル (`accountInfoModal.js`)
- 問い合わせモーダル (`contactModal.html`)
- 名刺設定モーダル (`bizcardSettings.html`)
- サンキューメール設定モーダル (`thankYouEmailSettings.html`)

## 8. バリデーション

- アンケート名、表示タイトル、回答受付開始日、回答受付終了日は必須項目であり、これらが入力されていない場合は保存ボタン（`createSurveyBtn`）が無効になる。

## 9. 今後の課題

- プレビュー機能の実装
- フォームの入力値保存・送信機能の実装
- 入力バリデーションの強化（詳細なルール設定）