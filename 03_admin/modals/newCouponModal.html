<!-- 新規クーポン作成モーダル -->
<div id="new-coupon-modal" class="fixed inset-0 z-40 bg-black bg-opacity-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none" data-state="closed">
    <div class="bg-surface rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col transition-transform duration-300 scale-95">
        <!-- モーダルヘッダー -->
        <header class="flex items-center justify-between p-4 border-b border-outline-variant">
            <h2 class="text-title-large font-semibold text-on-surface">新規クーポン作成</h2>
            <button data-action="close" class="p-2 rounded-full hover:bg-surface-container-highest">
                <span class="material-icons text-on-surface-variant">close</span>
            </button>
        </header>

        <!-- モーダルボディ -->
        <div class="p-6 overflow-y-auto">
            <form id="newCouponForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- クーポンコード -->
                    <label class="flex flex-col gap-1 text-on-surface-variant text-sm md:col-span-2">
                        <span>クーポンコード</span>
                        <div class="flex items-center gap-2">
                            <input type="text" id="newCouponCode" name="code" class="form-input flex-grow text-on-surface placeholder:text-on-surface-variant" placeholder="例: SPRING25" required maxlength="50">
                            <button type="button" id="generateCouponCode" class="inline-flex items-center gap-1 rounded-lg border border-outline px-3 py-2 text-sm font-semibold text-on-surface">
                                <span class="material-icons text-base">autorenew</span>
                                自動生成
                            </button>
                        </div>
                        <p class="text-xs text-on-surface-variant mt-1">半角英数字とハイフン(-)のみ使用可能</p>
                    </label>

                    <!-- クーポン名称 -->
                    <label class="flex flex-col gap-1 text-on-surface-variant text-sm md:col-span-2">
                        <span>クーポン名称</span>
                        <input type="text" id="newCouponName" name="name" class="form-input text-on-surface placeholder:text-on-surface-variant" placeholder="例: 2025年春のプロモーション" required maxlength="100">
                    </label>

                    <!-- 対象メールアドレス -->
                    <label class="flex flex-col gap-1 text-on-surface-variant text-sm md:col-span-2">
                        <span>対象メールアドレス (任意)</span>
                        <input type="email" id="newCouponTargetEmail" name="targetUserEmail" class="form-input text-on-surface placeholder:text-on-surface-variant" placeholder="例: user@example.com">
                        <p class="text-xs text-on-surface-variant mt-1">クーポンを送付する対象の記録用です。このメールアドレスのみに利用が制限されるわけではありません。</p>
                    </label>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 有効期限（開始） -->
                    <label class="flex flex-col gap-1 text-on-surface-variant text-sm">
                        <span>有効期限 (開始)</span>
                        <input type="date" id="newCouponValidFrom" name="validFrom" class="form-input text-on-surface placeholder:text-on-surface-variant" required>
                    </label>

                    <!-- 有効期限（終了） -->
                    <label class="flex flex-col gap-1 text-on-surface-variant text-sm">
                        <span>有効期限 (終了)</span>
                        <input type="date" id="newCouponValidTo" name="validTo" class="form-input text-on-surface placeholder:text-on-surface-variant" required>
                    </label>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 割引率 -->
                    <label class="flex flex-col gap-1 text-on-surface-variant text-sm">
                        <span>割引率 (%)</span>
                        <input type="number" id="newCouponDiscountRate" name="discountRate" class="form-input text-on-surface placeholder:text-on-surface-variant" placeholder="1〜50の整数" required min="1" max="50">
                    </label>

                    <!-- 利用回数上限 -->
                    <div class="flex flex-col gap-1 text-on-surface-variant text-sm">
                        <span>利用回数上限</span>
                        <input type="number" id="newCouponUsageLimit" name="usageLimit" class="form-input text-on-surface placeholder:text-on-surface-variant" placeholder="1以上の整数" required min="1">
                        <label class="flex items-center gap-2 mt-2 text-sm">
                            <input type="checkbox" id="unlimitedUsage" class="form-checkbox">
                            <span>無制限にする</span>
                        </label>
                    </div>
                </div>

                <!-- メモ -->
                <label class="flex flex-col gap-1 text-on-surface-variant text-sm">
                    <span>メモ (任意)</span>
                    <textarea id="newCouponMemo" name="memo" class="form-textarea text-on-surface placeholder:text-on-surface-variant" rows="3" placeholder="管理用の内部メモ" maxlength="500"></textarea>
                </label>
            </form>
        </div>

        <!-- モーダルフッター -->
        <footer class="flex items-center justify-end gap-3 p-4 border-t border-outline-variant">
            <button type="button" data-action="close" class="rounded-lg border border-outline px-4 py-2 text-sm font-semibold text-on-surface">キャンセル</button>
            <button type="submit" form="newCouponForm" class="rounded-lg bg-primary text-primary-on px-4 py-2 text-sm font-semibold">作成する</button>
        </footer>
    </div>
</div>