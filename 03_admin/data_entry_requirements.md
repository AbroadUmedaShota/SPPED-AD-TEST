# 要件定義書: データ入力状況

**文書バージョン:** 1.1
**作成日:** 2025年10月3日
**作成者:** [Gemini]

**改訂履歴**

| バージョン | 改訂日 | 改訂内容 | 改訂者 |
| :--- | :--- | :--- | :--- |
| 1.0 | 2025/10/03 | 初版作成 | [Gemini] |
| 1.1 | 2025/10/03 | 各セクションの詳細化、エラーハンドリング、非機能要件の追記 | [Gemini] |

---

## 1. 概要

### 1.1. 目的
本ドキュメントは、管理者およびオペレーター管理者がデータ入力タスクの進捗状況を一覧し、効率的に管理するための「データ入力状況」画面に関する要件を定義する。

### 1.2. 背景
複数の入力グループ（タスク）が並行して進行する中で、全体の進捗、滞留状況、完了率を直感的に把握し、問題のあるタスクへ迅速にアクセスできる画面が必要となった。本画面は、データ入力業務のボトルネック特定と生産性向上を支援することを目的とする。

### 1.3. スコープ
- データ入力タスクのサマリーと進捗状況の可視化。
- 各タスクから個別のデータ入力画面への遷移。
- 管理者向けの特定機能（入力モード切替）の表示。
- 既存の管理者画面（`03_admin`）の共通レイアウト（ヘッダー、サイドバー、フッター）を再利用する。

---

## 2. 画面配置と画面遷移

### 2.1. サイドバーへの追加
- 管理者画面のサイドバー (`03_admin/common/sidebar.html`) に、新しいナビゲーションリンクを追加する。
- **表示名:** データ入力状況
- **アイコン:** `speed` (Material Icons)
- **リンク先:** `data_entry.html` (本要件で作成する新しい画面)
- **配置場所:** 「データ入力・照合管理」の上、または隣接する位置。

### 2.2. 画面遷移
- ユーザーはサイドバーの「データ入力状況」リンクをクリックすることで、本画面にアクセスする。
- 本画面に表示される各タスクのレコードをクリックすると、該当するデータ入力画面 (`/admin/data-entry/form.html` 等) に遷移する。

---

## 3. レイアウトとUIコンポーネント

### 3.1. 基本レイアウト
- 既存の管理者画面と同様に、共通のヘッダー、サイドバー、フッターを使用する。
- メインコンテンツエリアのH1タイトルとして「**データ入力状況**」と表示する。

### 3.2. サマリー表示エリア
- **目的:** データ入力業務全体の状況を一目で把握する。
- **配置:** 画面上部。
- **表示項目:**
    - **KPIカード:** 以下の4つの指標を、アイコンと共にカード形式で表示する。各カードはクリック可能とし、クリックすると下部のタスク一覧が該当するステータスのタスクのみにフィルタリングされる。
        1.  **総件数:** (アイコン: `summarize`) 全タスクの総件数。
        2.  **エスカレ:** (アイコン: `report_problem`) エスカレーションされている件数。
        3.  **ロック中:** (アイコン: `lock`) 現在オペレーターが作業中でロックされている件数。
        4.  **完了:** (アイコン: `task_alt`) 全タスクの完了件数。
    - **進捗グラフ:**
        - **種類:** 折れ線グラフ。
        - **目的:** 完了件数の推移を視覚的に表示する。
        - **UI:** グラフ右上に表示期間を切り替えるためのセレクタ（「過去7日間」「過去30日間」）を配置する。デフォルトは「過去7日間」。
        - **X軸:** 時間（日）
        - **Y軸:** 完了件数

### 3.3. タスク一覧エリア
- **目的:** グループ（タスク）ごとの進捗を詳細に表示し、各入力画面への起点とする。
- **表示形式:** テーブル形式でタスクを一覧表示する。
- **テーブル列:**
    - **タスク名:** 例: 「グループ1」
    - **総件数**
    - **完了数**
    - **進捗率:**
        - `完了数 / 総件数` をパーセンテージで表示。
        - 進捗バーも併せて表示し、視覚的な進捗理解を補助する。
    - **担当者数:** このタスクにアサインされているオペレーターの人数。
    - **最終更新日時:** タスク内のいずれかのデータが最後に更新された日時。
- **インタラクション:**
    - 各列のヘッダーをクリックすることで、その列の内容に基づいて昇順/降順ソートが可能。
    - 各行はクリック可能であり、クリックすると該当タスクのデータ入力画面に遷移する。
- **エッジケース:**
    - 表示するタスクが0件の場合、テーブル領域に「表示対象のタスクはありません。」というメッセージを表示する。

### 3.4. 入力モード切替エリア
- **目的:** 上位権限者が入力モードを切り替えるためのUIを提供する（モックアップとしての表示）。
- **参照元:** `data_entry_admin_form.html` の概念を参考にする。
- **表示項目:**
    - **タイトル:** 「管理者用設定」
    - **スイッチ/ボタン:**
        - 「入力モード切替」などのラベルを持つトグルスイッチやラジオボタン群を配置。
        - (例: `[ラジオボタン] 通常入力`, `[ラジオボタン] 修正モード`, `[ラジオボタン] 照合モード`)
- **表示条件:**
    - `00_admin_requirements_design.md` に定義されている管理者ロールのうち、「**マネージャー**」および「**オペレーター管理者**」権限を持つユーザーにのみ表示される。
    - (※本モックアップ開発フェーズでは、権限に関わらず常に表示する)

---

## 4. 機能要件

### 4.1. データ表示
- **サマリー表示:** 画面読み込み時、全タスクを集計した各数値をKPIカードに表示する。
- **グラフ表示:** 完了件数の推移データを取得し、折れ線グラフとして描画する。
- **タスク一覧:** グループ1〜6の各タスクについて、必要なデータを取得し、テーブルに表示する。

### 4.2. 画面遷移
- タスク一覧の各行をクリックすると、`location.href` を使用して、該当タスクの入力画面（例: `/admin/data-entry/form.html?groupId=1`）に遷移させる。

### 4.3. エラーハンドリング
- 画面の初期化に必要なデータ（サマリー、グラフ、タスク一覧）の取得に失敗した場合、画面全体に「データの読み込みに失敗しました。時間をおいて再度お試しください。」というエラーメッセージと、再試行ボタンを表示する。

---

## 5. データモデル（案）

本画面を表示するために、フロントエンドが必要とするデータ構造の例。

```json
{
  // KPIカードおよびグラフ表示用データ
  "summary": {
    "totalItems": 6000,
    "escalatedItems": 50,
    "lockedItems": 120,
    "completedItems": 3500,
    "progressChart": {
      "labels": ["10/01", "10/02", "10/03", "10/04", "10/05", "10/06", "10/07"],
      "data": [500, 600, 800, 750, 850, 900, 950]
    }
  },
  // タスク一覧テーブル用データ
  "tasks": [
    {
      "id": "group1",
      "name": "グループ1",
      "total": 1000,
      "completed": 500,
      "operatorCount": 10, // このタスクを担当するオペレーター数
      "lastUpdatedAt": "2025-10-03T10:00:00Z" // タスク内の最終更新日時
    },
    {
      "id": "group2",
      "name": "グループ2",
      "total": 1000,
      "completed": 600,
      "operatorCount": 12,
      "lastUpdatedAt": "2025-10-03T09:55:00Z"
    }
    // ... more tasks
  ]
}
```

---

## 6. 非機能要件

- **ユーザビリティ:**
    - 各指標と進捗状況が直感的に理解できること。
    - 画面の応答性が高く、操作がスムーズであること。1秒以内の画面応答を目指す。
- **アクセシビリティ:**
    - KPIカードやテーブルは、スクリーンリーダーで内容が理解できるように、適切なARIA属性を付与する。
    - グラフは色だけでなく、形状やラベルでも情報が伝わるように配慮する。
- **データの鮮度:**
    - 画面に表示されるデータは、リアルタイムである必要はないが、少なくとも15分以内に更新されることが望ましい。画面には最終更新日時を表示する。
- **保守性:**
    - タスク（グループ）の数が将来的に増減した場合でも、容易に対応できるコンポーネント設計とすること。
- **デザイン:**
    - 既存の管理者画面 (`03_admin/src/admin-style.css`) のデザイントークン（色、フォント、スペーシング等）を遵守し、一貫性を保つ。

---

## 7. 将来の検討事項
- リアルタイム更新: 各指標（特にロック中・完了数）をWebSocket等を用いてリアルタイムに更新する機能。
- フィルタリング機能: 特定の期間やステータスでタスクを絞り込む機能（KPIカードクリックによるフィルタリングはv1.1で実装）。
- ドリルダウン機能: グラフの特定ポイントをクリックすると、その日の詳細な実績にドリルダウンする機能。
