---
owner: product
status: draft
last_reviewed: 2026-01-15
---

# 請求書関連ページ 仕様共有資料

## 1. 目的

開発チームが、モック実装と同等の「請求書関連ページ（一覧/詳細/PDF/印刷）」を再現できるように、参照先と仕様の要点を1枚に集約する。

## 2. 対象範囲（ユーザー画面）

| 画面ID | パス | 役割 |
| :--- | :--- | :--- |
| INV-001 | `02_dashboard/invoiceList.html` | 請求書一覧（月次サマリー） |
| INV-002 | `02_dashboard/invoice-detail.html` | 請求書詳細（Invoice Sheet 表示 + PDF出力） |
| INV-003 | `02_dashboard/invoice-print.html` | 印刷用ページ（ブラウザ印刷） |

スコープ外: 管理画面（`03_admin/`）での請求作成/編集、決済/入金消込、送付/督促フロー。

## 3. 正本（詳細仕様）

まずは以下の仕様書を正本として参照すること。

- 画面/機能要件（ユーザー画面）: `docs/画面設計/仕様/04_invoice_screen.md:1`
- INV-002 詳細画面要件: `docs/画面設計/仕様/04_invoice_detail_requirements.md:1`
- 帳票（PDF/印刷）要件: `docs/画面設計/仕様/05_invoice_document.md:1`
- 手動テスト: `docs/ハンドブック/テスト/invoice_manual_checklist.md:1`

## 4. データソース（モック）

- 請求書: `data/core/invoices.json`
- 請求先（個人）: `data/core/users.json`
- 請求先（グループ）: `data/core/groups.json`
- 料金比較/表記の参照資料: `docs/リファレンス/リソース/client-materials/service-plan-comparison.md`

## 5. URL と ID 仕様（必須）

### 5.1 `id`（URLパラメータ）

- `invoice-detail.html?id={id}`
- `invoice-print.html?id={id}`

`id` は以下のいずれかを受け付ける。

- 元請求書ID: `INV-YYYY-MM-SEQ`（例: `INV-2025-09-001`）
- 集計ID: `AGG-YYYYMM-{GROUP|PERSONAL}`（例: `AGG-202509-GROUP`）

### 5.2 集計IDの意味

INV-001 は請求書単位ではなく「請求月 + 契約種別（個人/グループ）」で集計したカードを表示し、詳細遷移には原則として集計IDを使用する。

### 5.3 表示用の請求書番号

画面上の請求書番号（表示用ID）は `YY-ユーザーID5桁-連番3桁` 形式とする（例: `25-00001-001`）。

## 6. UI/機能の要点（実装再現チェック）

### 6.1 INV-001 一覧（月次サマリー）

- 表示: 「請求月 / 対象期間 / 請求書番号 / 契約種別 / 合計請求額（税込）」をカード表示
- 並び: 請求月（`issueDate`）降順
- 操作: クリック + `Enter`/`Space` で INV-002 へ遷移
- 状態: ローディング/0件/取得失敗のメッセージを表示

### 6.2 INV-002 詳細（Invoice Sheet + PDF）

- 表示: A4の請求書レイアウト（Invoice Sheet）を画面内に表示（カード分割しない）
- ページ分割: 1ページ目20行、2ページ目以降42行で自動追加
- 請求先: `accountId` から `corporateName` / `contactPerson` を解決して表示
- PDF: `帳票ダウンロード` で `#invoice-sheet-container` をA4縦で出力

### 6.3 INV-003 印刷ページ

- 取得: `id` に応じて請求書を取得し、印刷用HTMLを生成して表示
- 印刷: 描画後に `window.print()` を自動実行
- 明細: `BASE/ADD_ON/ONE_TIME/CREDIT` の順で出力し、カテゴリ小計行を挿入

## 7. 実装参照（モック実装の読みどころ）

- 一覧集計（`AGG-...` の生成）: `02_dashboard/src/invoiceList.js`
- 集計IDの解決/明細連結/税計算: `02_dashboard/src/services/invoiceService.js`
- 請求先解決（users/groups）: `02_dashboard/src/invoiceDetail.js`
- 印刷ページのHTML生成: `02_dashboard/invoice-print.html`

## 8. 既知の仕様上の制約（重要）

- 印刷ページは `items[].category` で出力対象を絞るため、`category` が無い明細は出力されない。
- 集計ID（`AGG-...`）には請求書ごとの「小計」行（`isSubtotal: true`）が混在し、印刷ページには出ない（PDF/詳細では表示される）。
- 税計算の整合を保つため `items[].taxable` の付与を必須とする（帳票側の再計算で差分が出るため）。

## 9. ローカル起動（モック画面）

- `python -m http.server 8000`
- `http://localhost:8000/02_dashboard/index.html` を開く
