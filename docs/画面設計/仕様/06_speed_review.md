# 画面要件定義書: SpeedAd - SPEEDレビュー画面

## 1. 概要

本ドキュメントは、SpeedAdサービスのSPEEDレビュー画面に関する要件を定義する。
この画面は、ユーザーがアンケート回答データを効率的に確認、検索、管理するためのインターフェースとして機能する。

## 2. 画面目的

- ユーザーが特定のアンケートに紐づく回答データを一覧で把握できること。
- 回答データをキーワードで検索し、必要な情報を迅速に見つけられること。
- 回答の詳細情報を確認し、必要に応じて編集できること。
- 大量の回答データでも、ページネーションにより快適に閲覧できること。
- **[NEW]** データの全体傾向（回答数の推移や属性分布）を直感的に把握できるダッシュボード機能を提供すること。

## 3. レイアウトとコンポーネント

...(既存のレイアウト記述は変更なし。ここでは省略)...

### 3.3. モーダルウィンドウ (`reviewDetailModal`)

- **目的**: 特定のアンケート回答の詳細情報を表示する。
- **表示内容**:
    - **名刺情報セクション**: 回答に紐づく名刺の詳細情報（氏名、会社名、連絡先など）を動的に表示。
    - **アンケート回答セクション**: 回答者が入力したアンケートの全設問と回答内容を動的に表示。
- **操作**: 「閉じる」ボタンと「編集する」ボタンを配置。
- **データマッピング**: モーダル内の表示項目は、「6. データ連携」で定義された結合済みデータオブジェクトから取得する。
    | 表示セクション     | 表示項目          | データソースのキー                           |
    | :----------------- | :---------------- | :------------------------------------------- |
    | **名刺情報**       | 氏名              | `businessCard.name`                          |
    |                    | 会社名            | `businessCard.company`                       |
    |                    | 部署              | `businessCard.department`                    |
    |                    | 役職              | `businessCard.title`                         |
    |                    | メール            | `businessCard.email`                         |
    | **アンケート回答** | (質問1のテキスト) | `survey.questionGroups[0].questions[0].text` |
    |                    | (質問1の回答)     | `answers[0].value`                           |
    |                    | (質問2のテキスト) | `survey.questionGroups[0].questions[1].text` |
    |                    | (質問2の回答)     | `answers[1].value`                           |
    |                    | ...               | ...                                          |

### 3.4. アナリティクスダッシュボード (新規追加)

- **目的**: 画面を開いた瞬間に、現在の回答状況（ボリューム、勢い、内訳）を視覚的に伝える。
- **配置**: データテーブルの上部に配置。
- **構成要素**:
    1.  **KPIカードエリア**: 2つの主要指標を表示するカード群。
        - **回答総数**: フィルタリングされた現在の総回答数。
        - **現在選択中の設問**: メインテーブルで表示中の動的な設問名を表示する。
            - **画面上の特徴**: ドロップダウン風のデザイン。カード全体をクリックすることで設問選択モーダルが開き、表示対象を即座に変更可能。
    2.  **時間帯別トレンドグラフ**:
        - **種類**: 折れ線エリアチャート。
        - **軸設定 (新規)**: 「自動（投稿がある範囲のみ）」と「固定（9:00-19:00）」をスイッチで切り替え可能。日次比較の利便性を向上。
        - **特徴**: イベント等の「その日の動き」を可視化するため、当日の推移を表示。
    3.  **属性構成チャート**:
        - **種類**: ドーナツグラフ。
        - **内容**: 選択中の「設問」の回答内訳を表示。

### 3.5. 右サイドバー（ツールボックス）

- **目的**: 回答データのフィルタリング機能を提供する。
- **配置**: 画面右側にフローティングで表示。開閉可能。展開時は背景のグレー領域（オーバーレイ）をクリックすることで閉じることが可能。
- **構成要素**:
    1.  **検索タブ**: 「簡易検索」と「詳細検索」を切り替え可能。
    2.  **簡易検索**: 
        - **表示対象日**: 会期（1/4〜1/17）の各日程をドロップダウンで選択。選択すると開始・終了日時が自動セットされる。
        - **ステータス**: 「完了」「進行中」で絞り込み。
    3.  **詳細検索**:
        - **開始日時 / 終了日時**: カレンダーと時間入力で自由な範囲を指定可能。
        - **バリデーション**: 会期外の日付は選択不可（グレーアウト）。
    4.  **フィルターをリセット**: 絞り込み条件を初期状態（会期全体）に戻すボタン。
    5.  **詳細分析ページへ**: グラフ分析ページへ遷移するボタン。アイコンは `analytics` を使用。
        - **配置（現行実装）**: 右サイドバーではなく、上部KPIエリアの「現在選択中の設問」カード内に配置。

## 4. 機能要件

### 4.1. 回答データの表示と管理

- **初期表示**: 画面ロード時、URLのクエリパラメータ (`?surveyId=...`) に基づき、「6. データ連携」で詳述するロジックでデータを取得・結合し、テーブルに表示する。
- **ページネーション**: 結合・フィルタリング済みのデータ配列に対して、ページネーションを適用する。
- **ダッシュボード連動**:
    - **フィルター連動**: 日付フィルターが適用された際、ダッシュボードの全ての数値・グラフも即座に再集計・再描画されること。
    - **設問選択連動**: 設問選択画面（KPIカード/モーダル）で表示対象の設問（カラム）を変更した際、属性構成チャートも該当する設問の集計結果に切り替わること。

...(その他の機能要件は変更なし)...

## 5. 画面フロー

...(既存の画面フローは変更なし。ここでは省略)...

## 6. データ連携

SPEEDレビュー画面のデータは、複数のJSONファイルをクライアントサイドで結合して生成される。

### 6.1. データソース

- **アンケート設問（主）**: `data/core/surveys.json`
- **回答データ（主）**: `docs/サンプル/demo_answers/<surveyId>.json`
- **名刺データ（主）**: `docs/サンプル/demo_business-cards/<surveyId>.json`
- **回答データ（フォールバック）**: `data/responses/answers/<surveyId>.json`
- **名刺データ（フォールバック）**: `data/responses/business-cards/<surveyId>.json`
- **設問詳細（フォールバック）**: `data/surveys/enquete/<surveyId>.json`

### 6.2. データ結合ロジック

1.  **起点**: 画面ロード時にURLから `surveyId` を取得する。
2.  **アンケート特定**: `data/core/surveys.json` から `surveyId` に一致するアンケートオブジェクト (`survey`) を取得する。
3.  **回答データ取得**: まず `docs/サンプル/demo_answers/<surveyId>.json` を参照し、未取得時は `data/responses/answers/<surveyId>.json` を参照する。
4.  **名刺情報結合**: `answerSet` の各回答オブジェクト (`answer`) について、以下の処理を行う。
    - `docs/サンプル/demo_business-cards/<surveyId>.json`（未取得時は `data/responses/business-cards/<surveyId>.json`）から `answerId` をキーに対応する名刺オブジェクト (`businessCard`) を見つける。
    - 元の `answer` オブジェクトに、見つけた `businessCard` をプロパティとして追加する (例: `answer.businessCard = businessCard`)。
5.  **最終データ**: 上記の処理を経て、名刺情報がネストされた回答オブジェクトの配列が完成する。これが、画面のテーブル描画、検索、モーダル表示の元データとなる。

**最終的なデータオブジェクト構造（1件分）の例:**
```json
{
  "answerId": "ans-001",
  "surveyId": "survey-123",
  "timestamp": "2025-07-20T10:30:00Z",
  "cardId": "card-abc",
  "answers": [
    { "questionId": "q1", "value": "製品A" },
    { "questionId": "q6", "value": "High" }
  ],
  "businessCard": {
    "cardId": "card-abc",
    "name": "山田 太郎",
    "company": "株式会社テスト",
    "email": "yamada@example.com",
    ...
  }
}
```

## 7. 非機能要件

- **パフォーマンス**: 数千件以上の回答データでも、クライアントサイドでの結合・検索・ページネーションが1秒以内に応答すること。データ量が多い場合は、Web Workerの利用を検討する。

...(その他の非機能要件は変更なし)...
