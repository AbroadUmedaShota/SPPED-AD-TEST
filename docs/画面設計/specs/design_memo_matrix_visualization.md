# マトリクス設問（SA）の可視化：実装指示書

## 1. 目的
現在「グラフ非対象」となっているマトリクス形式（`matrix_sa`）の回答データを、集計・可視化可能にアップグレードする。

## 2. 推奨される可視化パターンと使い分け
マトリクスデータの特性（項目間の比較 vs 特定項目の深掘り）に応じて、以下の2パターンをモック内で両立させる。

### パターンA：100%積み上げ棒グラフ（標準表示）
- **用途**: SPEEDレビュー画面のダッシュボード（1つのカード内に収める場合）。
- **表示ロジック**: 
    - Y軸に「行項目（機能性、デザイン等）」を配置。
    - 色分け（シリーズ）に「選択肢（非常に良い〜悪い）」を割り当てる。
- **メリット**: カード1枚のスペースで、設問全体の傾向（どの項目が高評価で、どれが課題か）を一目で比較できる。

### パターンB：個別ドーナツチャート（詳細・並列表示）
- **用途**: 詳細分析ページ（`graph-page.html`）または、特定の行項目を強調したい場合。
- **表示ロジック**: 
    - 行項目ごとに1つのドーナツチャートを生成し、グリッド状に並べる。
- **メリット**: 各項目の満足度の「純粋な内訳」を正確に把握しやすい。

## 3. 実装上のデータ加工ロジック (Repチームへの指示)

### 3.1. データの正規化
マトリクスSAの回答は `{"行1": "選択肢A", "行2": "選択肢B"}` というオブジェクト形式で保持されている。これを集計関数（`buildChoiceSummary` 等）に渡す前に、正規化して集計すること。

### 3.2. 既存コード (`speed-review.js`) の修正箇所
1. **`BLANK_TYPES` からの除外**: `matrix_sa` を Set から削除し、集計対象に含める。
2. **レンダリング条件の追加**: 
    - タイプが `matrix_sa` の場合、ApexCharts の `stacked: true` オプションを有効にした横棒グラフを出力する。

## 4. UI/UX 補足事項
- **凡例の共通化**: 積み上げ棒グラフの場合、凡例はグラフ上部に1セットだけ表示し、各バーで共通利用すること。
- **ツールチップ**: バーにホバーした際、「行項目名 > 選択肢名: 〇〇件 (XX.X%)」と詳細が表示されるように設定すること。
