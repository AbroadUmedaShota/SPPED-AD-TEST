# 請求書詳細ページ 要件定義書 (INV-002)

最終更新日: 2025-10-15

---

## 1. 概要と目的

本ドキュメントは、SPEED AD ダッシュボードの請求書詳細ページ (`02_dashboard/invoice-detail.html`) の要件を定義する。

**目的:** 利用者が請求内容を正確に理解し、必要なアクション（支払、ダウンロード、問い合わせ等）をスムーズに行えるようにすること。

**主要なゴール:**
- 請求金額とその内訳が明確にわかる。
- 請求書のステータス（未入金、入金済みなど）がひと目でわかる。
- 請求書を PDF としてダウンロードしたり、印刷したりできる。
- 振込先情報を簡単に確認・コピーできる。

---

## 2. 画面構成と主要機能

### 2.1. ヘッダーエリア
- **表示項目:**
  - ページタイトル: `請求書詳細`
  - 請求書ID (`invoiceId`)
  - ステータス: `未入金`, `入金済`, `延滞`, `取消` のいずれかをバッジで表示。
  - 請求日 (`issueDate`)
- **主要機能:**
  - **PDFダウンロード:** 請求書データを PDF 形式でダウンロードする。
  - **印刷:** 印刷用のページ (`invoice-print.html`) を開く。
  - **問い合わせ:** `mailto` リンクを生成し、メーラーを起動する。件名に請求書IDを含める。

### 2.2. 請求サマリー
- **請求先情報:**
  - 会社名 (`corporateName`)
  - 担当者名 (`contactPerson`) ※任意
- **請求情報:**
  - 請求書番号 (`invoiceId`)
  - 支払期限 (`dueDate`)
  - 対象期間 (`billingPeriod`)
  - 契約プラン (`plan.displayName`)
  - 追加オプション (`addOns`) ※ない場合は「なし」と表示

### 2.3. 明細エリア
- **表示項目:** テーブル形式で以下の情報をリスト表示する。
  - `No.`
  - `項目`
  - `内訳`
  - `数量`
  - `単価`
  - `金額`
- **機能・仕様:**
  - 項目はカテゴリ（例: 基本料金、従量課金）ごとにグループ化して表示する。
  - 割引やクレジットなどのマイナス金額も正しく表示する。

### 2.4. 集計エリア
- **表示項目:**
  - `課税対象小計`
  - `非課税小計`
  - `消費税 (10%)`
  - `合計金額（税込）`
- **仕様:**
  - 合計金額は、ページ内で最も目立つように強調して表示する。

### 2.5. 振込先情報
- **表示項目:**
  - `銀行名`
  - `支店名`
  - `口座種別` (普通, 当座など)
  - `口座番号`
  - `口座名義`
- **機能:**
  - 振込先情報をワンクリックでクリップボードにコピーできるボタンを設置する。

### 2.6. メモ
- 請求に関する補足事項や注意事項を表示するエリア。
- この項目が空の場合は、セクション自体を非表示にする。

---

## 3. 画面フローと状態変化

- **画面遷移:**
  - 請求書一覧ページ (`invoiceList.html`) から、特定の請求書の「詳細」ボタンをクリックして遷移する (`?id={invoiceId}`)。
  - パンくずリスト (`請求書一覧 > {invoiceId}`) を設置し、一覧ページへ戻れるようにする。
- **画面の状態:**
  - **ローディング中:** データ取得中は、画面全体にスケルトンUIを表示し、操作を不可にする。
  - **正常表示:** データ取得後、上記で定義した各情報を表示する。
  - **エラー表示:**
    - **ID不正/該当なし:** 「対象の請求書が見つかりませんでした」と表示し、一覧へ戻るリンクを提示する。
    - **サーバーエラー:** 「データの取得に失敗しました。時間をおいて再度お試しください」と表示し、リロードを促す。

---

## 4. 非機能要件

- **レスポンシブ対応:**
  - スマートフォン等の幅が狭い画面でも情報が閲覧できるよう、レイアウトを最適化する。
  - 特に明細テーブルは、画面幅に応じて横スクロールで表示する。
- **アクセシビリティ:**
  - スクリーンリーダー利用者に配慮し、主要な要素（ステータスバッジ、ボタン等）に適切な `aria-label` を付与する。
  - キーボードのみですべての操作（ボタンクリック、コピー等）が完結できるようにする。
- **ログ:**
  - ページ表示、主要なボタン（ダウンロード、印刷、問い合わせ）のクリック、エラー発生時には、分析目的でイベントログを送信する。

---

## 5. 今後の検討事項

- PDF 生成機能の実装と、その際の電子署名の要否。
- 支払完了日 (`paidDate`) のデータ連携と画面への表示方法。
- 振込先口座が複数ある場合の UI 設計。
- 将来的な税率変更（軽減税率など）への対応方針。

