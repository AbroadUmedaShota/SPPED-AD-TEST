# 画面要件定義書: SpeedAd - サンクス画面設定

## 1. 概要
本ドキュメントは、アンケート回答後のサンクス画面に関する設定機能の要件を定義する。ユーザーは本機能を通じて、回答者へのメッセージ、連続回答の可否、名刺撮影機能の利用有無を設定できる。

## 2. 画面目的
- アンケート回答者への感謝と、次のアクションへの誘導を適切に行う。
- アンケートの運用目的に応じて、連続回答や名刺撮影の有無を柔軟に設定できるようにする。
- 名刺撮影機能の利用有無に応じて、関連機能（お礼メール設定、名刺データ化）の有効/無効を制御し、ユーザーの誤操作を防ぐ。

## 3. 機能要件

### 3.1. サンクス画面設定ページへの遷移
- **入口**: `surveyCreation.html` の「追加設定」カードに配置された「サンクス画面設定」ボタン。
- **遷移先**: `thankYouScreenSettings.html?surveyId=<currentSurveyId>`。アンケートIDが未生成の場合はボタン自体が無効化される。
- **トースト**: アンケートIDが無い状態で直接アクセスした場合はエラートーストで通知し、設定は読み込まない。

### 3.2. 回答後の文言設定
- **機能**: アンケート回答完了後に表示するサンクスメッセージを編集できる。
- **UI**: テキストエリア (浮動ラベル付き)。初期表示はデフォルト文言を自動挿入する。
- **リアルタイムフィードバック**: 入力に応じて `0/500` 形式の文字数カウンタを更新し、500文字を超過するとエラーメッセージと入力枠のエラースタイルを表示する。
- **制限事項**: 保存時も500文字に丸め込み、超過状態では保存せずトーストで警告する。
- **言語対応**: ページタイトルは現在の表示言語 (日本語/英語) に応じて切り替える。

### 3.3. お礼メール設定ボタンとの連携
- **配置**: アンケート作成画面 (`surveyCreation.html`) の「追加設定」カードに配置される。
- **遷移**: クリック時に `thankYouEmailSettings.html?s%5BsurveyId%5D` を生成し、現在編集中のアンケートIDをクエリに付与して遷移する。
- **状態制御**: アンケートID未発行時はボタンを無効化し、タイトルに「アンケートIDを発行後に利用できます。」と表示する。
- **名刺設定との依存**: 名刺撮影を無効化した場合はこのボタンも無効化し、「名刺撮影依頼を有効にすると利用できます。」をタイトルに表示する。

### 3.4. 連続回答設定
- **機能**: 回答完了後に同じ端末で続けて別の回答を受け付けるかどうかを切り替える。
- **UI**: トグルスイッチ (`<input type="checkbox" role="switch">`) を利用し、初期状態はOFF（連続回答を許可しない）。
- **依存関係**: トグルをONにした場合、サンクスメッセージの案内文を自動で更新し、連続回答が有効になることを回答者に明示する。

### 3.5. 名刺撮影機能の可否
- **機能**: アンケート回答フローに名刺撮影ステップを追加するかどうかを切り替える。
- **UI**: トグルスイッチ (`<input type="checkbox" role="switch">`) でオン/オフを制御する。
- **保存先**: 状態は `thankYouScreenSettings_<surveyId>` に保存され、切り替え時に関連ボタンの状態を即時更新する。

#### 3.5.1. 「名刺撮影を依頼しない」を選択した場合
- **連動するボタン**: アンケート作成画面の「名刺データ設定」「サンクスメール設定」は自動的に無効化され、ツールチップで理由を表示する。
- **表示メッセージ**: ページ内に赤字で「名刺撮影を依頼しない場合、名刺データ設定とサンクスメール設定は利用できません。」を表示する。
- **保存ロジック**: トグルをオフにした時点で `thankYouScreenSettings_<surveyId>` に反映される。

#### 3.5.2. 名刺データ未添付時のモーダル表示
- **トリガー**: 「名刺の撮影を依頼する」が選択されているアンケートで、回答者が名刺画像を添付せずにアンケートを送信しようとした場合。
- **期待される結果**: 以下の内容の確認モーダルが表示される。
  - **モーダルタイトル**: 「名刺データ未添付の確認」
  - **メッセージ**: `名刺データが添付されていません。このまま送信しますか？`
  - **ボタン**:
    - 「はい、送信する」: 名刺データなしでアンケートを送信する。プライマリボタン (`bg-primary text-on-primary`)
    - 「キャンセル」: モーダルを閉じ、回答フォームに戻り、名刺画像の添付を促す。セカンダリボタン (`bg-secondary-container text-on-secondary-container`)

## 4. UI/UX
- **レイアウト**:
  - ページ全体に「サンクス画面設定」のタイトル。
  - 各設定セクションは`<section>`で区切り、見出し (`<h2>`) を持つ。
  - 各設定セクションは、入力フィールドと補足説明をセットで配置し、ユーザーが変更点を把握しやすくする。
  - ページ背景は `bg-background`、メインカードはライトテーマで `bg-white`、ダークテーマで `bg-gray-800` とし、視認性を確保する。
  - ページ末尾に「保存」と「キャンセル」ボタンを配置する。
- **一貫性**: アプリケーション全体のデザインガイドライン (`docs/design/00_design_guideline.md`) に準拠する。
- **フィードバック**: 設定変更時には、トースト通知などでユーザーにフィードバックを提供する。
- **レスポンシブデザイン**: PC、タブレット、スマートフォンで適切に表示・操作できる。
- **アクセシビリティ**: キーボード操作、スクリーンリーダーに対応し、`aria-label` などの適切なARIA属性を設定する。

## 5. データモデル（変更案）

### `Survey` オブジェクトへの追加/変更
| プロパティ名 | データ型 | 必須 | デフォルト値 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| `thankYouMessage` | String | ⬜️ | `アンケートの送信が完了しました。ご回答ありがとうございました。` | 回答後に表示されるサンクス画面のメッセージ |
| `allowContinuousAnswer` | Boolean | ✅ | `false` | 連続回答の可否 (`true`: 許可, `false`: 不許可)。初期値は不許可。 |
| `requestBusinessCardPhoto` | Boolean | ✅ | `true` | 名刺撮影機能の可否 (`true`: 依頼する, `false`: 依頼しない) |

## 6. 非機能要件
- **パフォーマンス**: ページ遷移や設定変更時の応答速度は3秒以内を目指す。
- **セキュリティ**: 設定変更は認証されたユーザーのみが行えるようにする。
- **保守性**: 新しい設定項目が追加された場合でも、容易に拡張できるような設計とする。
- **国際化**: 将来的な多言語対応を考慮し、メッセージやラベルは外部化可能な設計とする。
- **テスト容易性**: 各機能が単体でテスト可能であるようにモジュール化する。
