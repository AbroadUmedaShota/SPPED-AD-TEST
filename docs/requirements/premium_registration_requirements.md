# プレミアム登録画面 要件定義書

## 1. 概要

### 1.1. 目的
本ドキュメントは、無料アカウント作成後のユーザーがプレミアムサービスに登録するための画面（以下、プレミアム登録画面）の要件を定義する。ユーザーが円滑にプレミアムサービスへ移行し、必要な情報を正確に登録できる仕組みを構築することを目的とする。

### 1.2. 対象ユーザー
- 無料アカウントを所持しているユーザー
- プレミアムサービスへの登録を希望するユーザー

## 2. 前提条件

### 2.1. システムフロー
- **ログイン済みユーザーの場合:**
    - 無料アカウントでログインしているユーザーは、プレミアム登録画面へ直接遷移できる。
- **未ログイン/長時間経過ユーザーの場合（タイムアウト含む）:**
    - 未ログイン状態のユーザー、またはログインから長時間経過しセッションがタイムアウトしたユーザーは、再度ログイン画面へリダイレクトされる。
    - ログイン成功後、自動的にプレミアム登録画面へ遷移する。

## 3. 登録情報要件

プレミアム登録画面でユーザーに入力・選択させる情報は以下の通りとする。

### 3.1. アカウント情報（必須）
ログインに必要な情報として、以下の項目を必須とする。

- **メールアドレス (email)**
    - 既存アカウントのメールアドレスを初期表示とする。変更可能とするか否かは別途検討。
- **パスワード（確認用含む）**
    - セキュリティ確保のため、確認用を含め再入力させる。

### 3.2. ユーザー基本情報

BtoBサービスであるため、会社情報の入力も重要視する。

- **氏名 (lastName, firstName)**
    - 必須項目とする。
- **会社名 (companyName)**
    - 必須項目とする。
- **電話番号 (phoneNumber)**
    - 必須項目とする。
- **部署名・役職名 (departmentName, positionName)**
    - 任意項目とする。

### 3.3. 住所情報（必須）

請求書払い等のサービス提供に必要となるため、以下の住所情報を必須とする。

- **郵便番号 (postalCode)**
    - 必須項目とする。入力された郵便番号に基づいて住所の自動入力機能を提供することが望ましい。
- **住所（都道府県・市区町村・番地） (address)**
    - 必須項目とする。
- **建物名・部屋番号 (buildingFloor)**
    - 任意項目とする。

### 3.4. 請求先情報

- ユーザーは「ユーザーの住所と同じ」または「別の請求先を入力」を選択できる機能を提供する。
    - 「ユーザーの住所と同じ」を選択した場合、3.3.で入力された住所情報を自動的に適用する。
    - 「別の請求先を入力」を選択した場合、3.3.と同様の住所入力フォームを表示する。

### 3.5. 同意事項（必須）

昨今の個人情報保護の観点から、以下の同意事項は必須とし、チェックがされていない場合はプレミアム登録を完了できないようにする。

- **利用規約への同意**
    - チェックボックス形式。利用規約へのリンクを設置する。
- **プライバシーポリシーへの同意**
    - チェックボックス形式。プライバシーポリシーへのリンクを設置する。
- **個人情報の取り扱いに関する同意**
    - チェックボックス形式。個人情報の取り扱いに関する説明へのリンクを設置する。
    - **この項目に同意がない場合、アカウント作成（プレミアム登録）を許可しないフローとする。**

## 4. ユーザー体験 (UX) 要件

### 4.1. 入力フォームのバリデーション
- **リアルタイムバリデーション**: 入力中に書式エラー（メールアドレス形式、電話番号の桁数など）や必須項目の未入力を検知し、即座にエラーメッセージを表示する。
- **パスワード強度**: パスワード設定時には、最小文字数、大文字・小文字・数字・記号の組み合わせなどの要件を示し、その充足度をリアルタイムでフィードバックする。

### 4.2. エラーハンドリング
- **明確なフィードバック**: サーバー側でのエラー（例: 予期せぬエラー）が発生した場合、ユーザーに「時間をおいて再度お試しください」といった内容のエラーメッセージを明確に表示する。

### 4.3. 入力補助
- **住所自動入力**: 郵便番号を入力すると、対応する住所（都道府県・市区町村）が自動的に入力される機能を提供する。
- **入力例の提示**: 各入力フィールドには、プレースホルダー等で入力例を提示する（例: `03-1234-5678`）。

### 4.4. 画面遷移と状態表示
- **プログレス表示**: 登録処理中は、ローディングインジケーター等を表示し、システムが動作中であることをユーザーに明確に伝える。
- **ステップ表示（パンくずリスト形式）**: 登録ステップが複数ある場合、現在のステップと全体の進捗を視覚的に示すステップ表示（例: パンくずリスト、ステッパー）を画面上部に設置する。これにより、ユーザーは現在の位置と残りのステップを容易に把握できる。
- **登録完了**: 登録が正常に完了した後は、完了メッセージと次のアクション（例: 「ダッシュボードへ進む」）を提示する完了画面へ遷移させる。

## 5. セキュリティ要件

### 5.1. 通信とデータ保護
- **HTTPS通信**: プレミアム登録画面を含む全ての通信は、TLS/SSLにより暗号化されたHTTPS通信で行う。
- **パスワードのハッシュ化**: ユーザーパスワードは、ソルトを用いた強力なハッシュアルゴリズム（例: Argon2, bcrypt）を使用してハッシュ化し、データベースに保存する。平文での保存は絶対に許可しない。

### 5.2. 不正アクセス対策
- **CSRF (クロスサイトリクエストフォージェリ) 対策**: フォーム送信時にCSRFトークンを検証し、不正なリクエストを防止する。
- **XSS (クロスサイトスクリプティング) 対策**: ユーザーからの全ての入力値は、画面に表示する前に適切にエスケープ処理（サニタイズ）を行い、悪意のあるスクリプトの実行を防止する。
- **レートリミット**: 登録フォームの送信やログイン試行など、特定の操作に対してIPアドレス単位で試行回数に上限を設け、ブルートフォース攻撃やリスト型攻撃を緩和する。
- **reCAPTCHAの導入**: ボットによる自動的な大量登録を防止するため、Google reCAPTCHAなどのチャレンジ・レスポンス型テストを導入する。

## 6. 支払い・請求関連

### 6.1. 支払い方法
- プレミアムプランの支払いは、**銀行振込のみ**とする。クレジットカード決済はスコープ外とする。

### 6.2. 請求プロセスの案内
- 登録画面では、クレジットカード情報などの決済情報を入力する代わりに、以下の点をユーザーに明確に案内する。
    - プレミアムプランの料金（月額10,000円、税別）。
    - 登録後、請求書が発行されること。
    - 請求書に記載された振込先口座へ、指定の期日までに支払いが必要であること。
    - 請求書はダッシュボードの請求書一覧画面から確認・ダウンロード可能であること。

### 6.3. 請求先情報の確認
- 請求書を正確に発行するため、「3.2. ユーザー基本情報」および「3.3. 住所情報」で入力された情報が請求書送付先として使用されることを明記する。
- 「3.4. 請求先情報」で「別の請求先を入力」が選択された場合は、そちらが優先されることを案内する。

### 6.4. プレミアム機能の有効化タイミング (検討事項)
プレミアム機能の有効化タイミングについては、以下の2つの選択肢から、ビジネスリスク、運用負荷、ユーザー体験を総合的に考慮し、別途決定する必要がある。

- **A案: 登録完了後、即時有効化**
    - ユーザーがプレミアム登録を完了した時点で、プレミアム機能を即座に利用可能とする。
    - メリット: ユーザー体験がスムーズ。
    - デメリット: 未払い時のリスク（サービス利用後の未払い）が発生する。未払いユーザーに対する機能停止や督促などの運用フローが必要となる。
- **B案: 入金確認後、有効化**
    - ユーザーからの銀行振込による入金が確認できた時点で、プレミアム機能を利用可能とする。
    - メリット: 未払いリスクを抑制できる。
    - デメリット: 入金確認までのタイムラグが発生し、ユーザーは即座にプレミアム機能を利用開始できない。入金確認が遅れた場合のユーザーへの連絡や、入金状況のステータス表示など、ユーザー体験への配慮が必要となる。