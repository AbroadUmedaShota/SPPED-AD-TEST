# サイドバーコンポーネントのコードレビュー

## 1. モバイルサイドバーがモーダル操作でも閉じてしまう
- **内容**: ナビゲーションリンクをクリックした際、`link.onclick` が未定義のときのみモバイルサイドバーを閉じる設計ですが、`account-info` などの項目には `addEventListener` でコールバックを登録しているため `onclick` プロパティは常に `null` のままです。その結果、モーダルを開く系のリンクでもサイドバーが閉じ、オーバーレイの解除→スクロール解放が走ってしまいます。
- **根拠**: ナビゲーション項目は `item.onClick` が指定されると `addEventListener` でモーダル表示を登録していますが、モバイルクローズ判定は `link.onclick` を参照しています。【F:02_dashboard/src/sidebarHandler.js†L98-L129】【F:02_dashboard/src/sidebarHandler.js†L193-L200】
- **影響**: モーダルを開いた直後にオーバーレイが剥がれてしまい、スクロールが有効化されるため背面のページが動いてしまいます。モバイル端末でのアカウント情報閲覧やグループ作成モーダル表示時にUXが損なわれます。
- **提案**: モバイルクローズ判定を `item.preventAutoClose` などのフラグで制御するか、`dataset` 属性によりモーダル系リンクを判別するよう修正してください。`addEventListener` の利用だけでは `onclick` が変化しない点に留意が必要です。

## 2. パスワード変更画面用のナビゲーションガードが呼び出されない
- **内容**: パスワード変更画面で定義されているサイドバー遷移ガード関数 `window.attachPasswordChangeNavGuard` を初期化時に呼ぶ想定ですが、`sidebarHandler` から誤って `window.attachPasswordChange_changeNavGuard()` を呼んでいるため実行されません。
- **根拠**: `password_change.js` 側で公開している関数名と、`sidebarHandler.js` 側の呼び出し名が一致していません。【F:02_dashboard/src/password_change.js†L222-L247】【F:02_dashboard/src/sidebarHandler.js†L221-L231】
- **影響**: パスワード入力欄に未保存の内容があってもサイドバーから他画面へ遷移できてしまい、確認モーダルが表示されません。ユーザーが意図せず入力を失いかねません。
- **提案**: 呼び出し名を `window.attachPasswordChangeNavGuard()` に修正し、ガードが確実に実行されるようにしてください。ページアンロード時のクリーンアップも既に実装されているため追加の対応は不要です。

## 3. 表示中グループ名が常に "Current Group" のままでローカライズされていない
- **内容**: プロファイルブロックとグループセレクトの初期値が固定文字列 "Current Group" のままで、実際に選択されているグループ名も日本語ラベルにも置き換わりません。UI文言定義では動的差し込みを想定しています。
- **根拠**: サイドバーHTML内のラベルおよび `populateGroupSelect` のデフォルトオプションが固定文字列になっています。【F:02_dashboard/common/sidebar.html†L9-L22】【F:02_dashboard/src/sidebarHandler.js†L135-L151】 UI文言定義でも「Current Group (※動的にグループ名が入る)」とされており、固定表示は仕様と乖離しています。【F:docs/design/01_ui_messages.md†L18-L37】
- **影響**: 実際にどのグループのデータを閲覧しているかが分かりにくく、特に多グループ運用時に誤操作を招く可能性があります。日本語UIに英語文言が残ることでプロダクト完成度も下がります。
- **提案**: 初期化時に現在のグループ名を表示し、セレクト変更に合わせてプロファイルブロックのラベルを更新してください。固定英語表記は UI 文言リストに合わせて日本語へ置き換える必要があります。
