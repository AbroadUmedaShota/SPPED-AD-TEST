# 画面要件定義書: SpeedAd - サンクス画面設定

## 1. 概要
本ドキュメントは、アンケート回答後のサンクス画面に関する設定機能の要件を定義する。ユーザーは本機能を通じて、回答者へのメッセージ、連続回答の可否、名刺撮影機能の利用有無を設定できる。

## 2. 画面目的
- アンケート回答者への感謝と、次のアクションへの誘導を適切に行う。
- アンケートの運用目的に応じて、連続回答や名刺撮影の有無を柔軟に設定できるようにする。
- 名刺撮影機能の利用有無に応じて、関連機能（お礼メール設定、名刺データ化）の有効/無効を制御し、ユーザーの誤操作を防ぐ。

## 3. 機能要件

### 3.1. サンクス画面設定ページへの遷移
- **トリガー**: `surveyCreation.html` の「追加設定」セクションに配置される「サンクス画面設定」ボタンをクリックする。
- **UI**: セカンダリボタン (`min-w-[100px] px-6 py-3 rounded-full bg-secondary-container text-on-secondary-container font-semibold transition-colors`)
- **期待される結果**: サンクス画面設定ページ (`thankYouScreenSettings.html` を想定) へ遷移する。

### 3.2. 回答後の文言設定
- **機能**: アンケート回答後に表示されるサンクス画面のメッセージをユーザーが自由に設定できる。
- **UI**: テキストエリア (`<textarea>`) を使用し、Raised Labelスタイルを適用する。
- **デフォルト表示**: テキストエリアには以下のデフォルトメッセージが初期表示される。
  `アンケートの送信が完了しました。ご回答ありがとうございました。`
- **バリデーション**: 最大文字数（例: 500文字）を設定し、超過した場合はエラーメッセージを表示する。必須項目ではない。
- **多言語対応**: 将来的に、多言語対応されたアンケートの場合、言語ごとにメッセージを設定できるように拡張することを考慮する。

### 3.3. 連続回答機能の可否
- **機能**: アンケート回答者が一度回答した後、同じアンケートに連続して回答できるか否かを設定できる。
- **UI**: トグルスイッチ (`<input type="checkbox" role="switch">`) またはラジオボタン (`<input type="radio">`) で「連続回答を許可する」/「連続回答を許可しない」を選択できるようにする。
  - **「連続回答を許可する」**: 回答者がアンケートを送信した後、再度同じアンケートURLにアクセスした場合、回答フォームが再表示され、新しい回答を開始できる。
  - **「連続回答を許可しない」**: 回答者がアンケートを送信した後、再度同じアンケートURLにアクセスした場合、回答済みであることを示すメッセージ（例: 「このアンケートには既に回答済みです。ご協力ありがとうございました。」）を表示し、回答フォームを非表示にする。
- **デフォルト**: 「連続回答を許可する」が初期選択される。

### 3.4. 名刺撮影機能の可否
- **機能**: アンケート回答者に名刺の撮影を依頼するか否かを設定できる。
- **UI**: トグルスイッチ (`<input type="checkbox" role="switch">`) またはラジオボタン (`<input type="radio">`) で「名刺の撮影を依頼する」/「名刺の撮影を依頼しない」を選択できるようにする。
- **デフォルト**: 「名刺の撮影を依頼する」が初期選択される。

#### 3.4.1. 「名刺の撮影を依頼しない」選択時の挙動
- **関連機能の無効化**: 「名刺の撮影を依頼しない」が選択された場合、`surveyCreation.html` の「追加設定」セクションにある以下の機能は自動的に無効化され、設定変更ができないようにUIを非活性化する。
  - `お礼メール設定` (thankYouEmailSettings.html への遷移ボタン)
  - `名刺データ化設定` (bizcardSettings.html への遷移ボタン)
- **UI表現**:
  - ボタンはグレーアウト (`bg-button-disabled-bg text-button-disabled-text`) され、クリックできないようにする。
  - マウスオーバー時にツールチップで「名刺撮影を依頼しない設定のため、この機能は利用できません。」と表示する。
- **理由**: 名刺データがないため、これらの機能は意味をなさないため。

#### 3.4.2. 名刺データ未添付時のモーダル表示
- **トリガー**: 「名刺の撮影を依頼する」が選択されているアンケートで、回答者が名刺画像を添付せずにアンケートを送信しようとした場合。
- **期待される結果**: 以下の内容の確認モーダルが表示される。
  - **モーダルタイトル**: 「名刺データ未添付の確認」
  - **メッセージ**: `名刺データが添付されていません。このまま送信しますか？`
  - **ボタン**:
    - 「はい、送信する」: 名刺データなしでアンケートを送信する。プライマリボタン (`bg-primary text-on-primary`)
    - 「キャンセル」: モーダルを閉じ、回答フォームに戻り、名刺画像の添付を促す。セカンダリボタン (`bg-secondary-container text-on-secondary-container`)

## 4. UI/UX
- **レイアウト**:
  - ページ上部に「サンクス画面設定」のタイトル。
  - 各設定項目はセクション (`<section>`) で区切り、見出し (`<h2>`) を設ける。
  - 各設定項目は、入力フィールドと説明文をセットで配置し、ユーザーが設定内容を理解しやすいようにする。
  - ページ下部に「保存」と「キャンセル」ボタンを配置する。
- **一貫性**: アプリケーション全体のデザインガイドライン (`docs/design/00_design_guideline.md`) に準拠する。
- **フィードバック**: 設定変更時には、トースト通知などでユーザーにフィードバックを提供する。
- **レスポンシブデザイン**: PC、タブレット、スマートフォンで適切に表示・操作できる。
- **アクセシビリティ**: キーボード操作、スクリーンリーダーに対応し、`aria-label` などの適切なARIA属性を設定する。

## 5. データモデル（変更案）

### `Survey` オブジェクトへの追加/変更
| プロパティ名 | データ型 | 必須 | デフォルト値 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| `thankYouMessage` | String | ⬜️ | `アンケートの送信が完了しました。ご回答ありがとうございました。` | 回答後に表示されるサンクス画面のメッセージ |
| `allowContinuousAnswer` | Boolean | ✅ | `true` | 連続回答の可否 (`true`: 許可, `false`: 不許可) |
| `requestBusinessCardPhoto` | Boolean | ✅ | `true` | 名刺撮影機能の可否 (`true`: 依頼する, `false`: 依頼しない) |

## 6. 非機能要件
- **パフォーマンス**: ページ遷移や設定変更時の応答速度は3秒以内を目指す。
- **セキュリティ**: 設定変更は認証されたユーザーのみが行えるようにする。
- **保守性**: 新しい設定項目が追加された場合でも、容易に拡張できるような設計とする。
- **国際化**: 将来的な多言語対応を考慮し、メッセージやラベルは外部化可能な設計とする。
- **テスト容易性**: 各機能が単体でテスト可能であるようにモジュール化する。