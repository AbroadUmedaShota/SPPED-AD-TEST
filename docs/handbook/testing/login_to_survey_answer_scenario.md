# ログイン画面から回答画面への遷移シナリオ

最終更新日: 2025-10-14

## 1. 対象
- `index.html`（ログイン画面）
- `02_dashboard/index.html`（ダッシュボード）
- `02_dashboard/survey-answer.html`（アンケート回答画面）
- 参照データ: `data/surveys/enquete/*.json`

## 2. 事前準備
1. `python -m http.server 8000` 等でリポジトリ直下を配信し、`http://localhost:8000/index.html` にアクセスする。
2. ブラウザは Chrome / Firefox の最新バージョンを推奨し、テスト前にローカルストレージをクリアする。
3. `data/surveys/enquete/sv_0001_25022.json` が存在し、アンケート一覧へ読み込まれていることを確認する。

## 3. 基本シナリオ（ANS-001 標準ユーザー）
| ステップ | 操作 | 期待結果 |
| :--- | :--- | :--- |
| 1 | ログイン画面の「シナリオテスト用アカウント」から `user` を選択し、自動入力された状態で「ログイン」を押す。 | 疑似ログイン完了後、`02_dashboard/index.html` が開き、アンケート一覧テーブルが即時に描画される。`sv_0001_25022` などのサンプル行が表示される。 |
| 2 | 一覧から任意のアンケート行（例: `sv_0001_25022`）をクリックし、詳細モーダルの「アンケートURL」をコピーする。 | モーダルにアンケートの概要が表示され、URL 欄に `https://survey.speedad.com/qr/sv_0001_25022` 形式の値がセットされている。コピー操作でクリップボードへ保持される。 |
| 3 | コピーした URL のドメインを `http://localhost:8000` へ差し替え、`http://localhost:8000/02_dashboard/survey-answer.html?surveyId=sv_0001_25022` を新規タブで開く。 | 回答画面が読み込まれ、タイトル・設問が `data/surveys/enquete/sv_0001_25022.json` の内容と一致する。名刺添付セクションは JSON の `settings.attachCard` に従い表示が切り替わる。 |
| 4 | 必須設問（`required: true`）をすべて入力し、「送信」を押す。 | 送信完了メッセージが同画面に表示され、`role="status"` の領域で完了を通知する。フォームはロックされ、再送信できない。 |
| 5 | ブラウザの開発者ツールでネットワークタブとコンソールを確認する。 | エラーが発生していない。`survey-answer.js` が `resolveDashboardDataPath()` から JSON を正常取得していることが確認できる。 |

## 4. 分岐シナリオ
- **ANS-002 新規ユーザー (`new`)**: ログイン後に `04_first-login/index.html` へ遷移し、チュートリアル完了またはスキップまではダッシュボードへ到達しない。ダッシュボード操作が必要な場合はチュートリアルを完了する。 
- **ANS-003 管理者 (`admin`)**: ログイン後 `03_admin/index.html` に遷移する。アンケート回答の検証は標準ユーザーで実施する。 
- **ANS-004 URL パラメータ欠落**: `survey-answer.html` をパラメータ無しで開くと「アンケートIDが指定されていません。」が表示される。`?id=` を付与して再実行する。 
- **ANS-005 不正 ID**: 存在しない ID を指定すると「指定されたアンケートが見つかりませんでした。」が表示される。ダッシュボードと JSON の整合を再確認する。 
- **ANS-006 多言語確認**: `settings.supportedLocales` に複数言語がある場合、右上の言語切替 UI を操作し、設問文・完了メッセージが切り替わることを確認する。

## 5. データおよび表示確認ポイント
- ダッシュボードのアンケート ID と回答画面が参照する JSON ファイル名が一致すること（例: `sv_0001_25022` ↔︎ `data/surveys/enquete/sv_0001_25022.json`）。
- 回答画面のタイトル、設問文、サンクスメッセージ、添付可否などは JSON の `content` / `settings` / `thankYouScreenSettings` の値と一致すること。
- `thankYouScreenSettings.showDownloadLink` が `true` の場合、完了メッセージにダウンロードリンクが表示され、クリックで指定 URL が開くこと。
- JSON を空配列に変更した際は、回答画面が「設問が設定されていません。」メッセージを表示すること（データ欠落検証）。
