# 請求書機能 手動確認チェックリスト（ユーザー画面）

最終更新日: 2026-01-15

## 1. 対象

- INV-001: `02_dashboard/invoiceList.html`
- INV-002: `02_dashboard/invoice-detail.html`
- INV-003: `02_dashboard/invoice-print.html`

## 2. 事前準備

- `python -m http.server 8000` でリポジトリ直下を起動し、`http://localhost:8000/02_dashboard/index.html` からダッシュボードへアクセス。
- ブラウザは Chrome / Firefox の最新バージョンを推奨。
- コンソールを開き、エラーが出ていないことを確認しながら実施。

## 3. INV-001 一覧（月次サマリー）

### 3.1 初期表示

1. ページにアクセスし、ローディング文言「読み込み中です…」が一時的に表示されること。
2. ロード完了後、カードが「請求月」降順で表示されること。

### 3.2 カード表示内容

任意のカードで、以下が表示されること。

1. 請求月（例: `2025年09月請求`）
2. 対象期間（例: `2025-08-01 ? 2025-08-31`）
3. 請求書番号（例: `25-00001-001` 形式）
4. 契約種別バッジ（`個人` / `グループ`）
5. 合計請求額（税込、3桁区切り）

### 3.3 遷移

1. カードをクリックすると `invoice-detail.html?id=AGG-...` に遷移すること。
2. カードにフォーカスを当て、`Enter` または `Space` で同様に遷移すること。

### 3.4 空/エラー

1. `data/core/invoices.json` を一時的に空配列にすると、「対象の請求書がありません。」が表示されること。
2. オフライン（または 404 を誘発）でリロードすると、「請求データの取得に失敗しました。ページを再読み込みしてください。」が表示されること。

## 4. INV-002 詳細（Invoice Sheet + PDF）

### 4.1 画面表示

1. URL パラメータ `id` に応じて請求書が表示されること。
2. Invoice Sheet が画面内に表示され、A4レイアウトになっていること。
3. 発行日 / 請求書番号 / 宛名 / 金額 / 振込先 / 支払期限 が表示されること。

### 4.2 ページ分割

1. 明細が多い請求書で、2ページ目以降が自動生成されること（ページ番号 `{current}/{total}` が整合すること）。

### 4.3 PDF（帳票ダウンロード）

1. `帳票ダウンロード` をクリックするとPDFがダウンロードされること。
2. ファイル名が `invoice-{id}.pdf` 形式であること（`id` は URL の値）。
3. PDFがA4縦で、ページごとに改ページされ、レイアウトが破綻しないこと。

### 4.4 異常系

1. `id` を付けずにアクセスすると「請求書IDが指定されていません。」が表示されること。
2. 存在しない `id` を指定すると「対象の請求書が見つかりませんでした。」が表示されること。

## 5. INV-003 印刷ページ（ブラウザ印刷）

### 5.1 初期表示

1. `invoice-print.html?id=...` を開くと、請求書が表示されること。
2. 描画後に印刷ダイアログが自動で開くこと。

### 5.2 明細（カテゴリ別 + 小計）

1. `BASE` / `ADD_ON` / `ONE_TIME` / `CREDIT` の順に出力されること。
2. 各カテゴリの末尾に小計行が表示されること。

### 5.3 備考

1. `notes` がある請求書では備考が表示されること。
2. `notes` が無い請求書では備考ブロック自体が表示されないこと。

### 5.4 集計ID（`AGG-...`）での差分確認（任意）

1. `invoice-detail.html?id=AGG-...` で表示される「小計」行（`isSubtotal: true`）が、`invoice-print.html?id=AGG-...` では出力されないこと（現行仕様）。

## 6. データ品質チェック（帳票整合の前提）

以下を満たさない場合、印刷ページの明細欠落や税計算差異が発生するため、データ側を修正すること。

1. すべての明細に `category` が付与されていること。
2. すべての明細に `taxable` が付与されていること。
