# グラフ分析画面仕様書: "Insight Finder"

## 1. 概要
本画面 (`graph-page.html`) は、アンケート回答データの「全体傾向」を把握し、属性間の差異を「比較・発見」するための分析特化ダッシュボードである。
SPEED Reviewが「個別の回答確認（Operational）」であるのに対し、本画面は「戦略的分析（Analytical）」を目的とする。

## 2. コア・コンセプト
- **Insight Finder**: 単なる集計表示ではなく、差異や特徴を能動的に発見するワークスペース。
- **Dynamic Analysis**: フィルターや軸を切り替えることで、動的にグラフが変化・再集計される。
- **Premium Showcase**: 高度な分析機能をPremiumプラン限定とし、Standardユーザーへのアップセル機会を創出する。

## 3. 機能要件

### 3.1 画面構成 (3-Pane Layout)
1.  **左サイドバー (Control Panel)**:
    -   期間設定 (Date Range Picker)
    -   グローバルフィルター（属性、回答条件など）
2.  **上部ヘッダー (Summary Header)**:
    -   集計サマリー（回答総数、回答率、平均回答時間など）
    -   アクティブフィルター表示エリア
3.  **メインエリア (Canvas)**:
    -   グラフカードのMasonryレイアウト表示

### 3.2 チャートカード機能
各設問ごとにカード形式でグラフを表示する。

- **グラフタイプ切替**: 棒グラフ (Bar) / 円グラフ (Pie) / 積み上げ棒グラフ (Stacked - Premiumのみ)
- **クロス集計**: 任意の属性でグラフを分解して表示（Premiumのみ）。
- **画像保存**: 個別グラフのPNGダウンロード。
- **自動考察**: データの特徴（最大値、有意差など）をテキストで自動表示（将来拡張）。

### 3.3 データ分析機能

| 機能                   | Standard / Free         | Premium                     |
| :--------------------- | :---------------------- | :-------------------------- |
| **期間フィルタリング** | ✅ 利用可                | ✅ 利用可                    |
| **属性フィルタリング** | ❌ **不可** (ロック表示) | ✅ **利用可**                |
| **回答ドリルダウン**   | ❌ **不可**              | ✅ **利用可**                |
| **クロス集計**         | ❌ **不可** (ロック表示) | ✅ **利用可**                |
| **VSモード (比較)**    | ❌ **不可** (ロック表示) | ✅ **利用可** (左右分割比較) |
| **PDFレポート**        | ❌ **不可**              | ✅ **利用可**                |

---

## 4. UI/UX仕様 (Standard vs Premium)

### 4.1 Standardユーザー体験
- **基本機能**: 期間指定による単純集計（全体％）のみ利用可能。
- **ロック表示**:
    -   サイドバーの属性リストは表示されるが、グレーアウトされ「🔒」アイコンが付く。
    -   グラフカードの「内訳」メニューに「🔒」アイコンが付く。
- **アップセル誘導**:
    -   ロックされた要素をクリックすると、**「Premium Upsell Modal」**が表示される。
    -   モーダルには「この機能で何ができるか（ベネフィット）」と「プラン比較」を表示。

### 4.2 Premiumユーザー体験
- **フルアクセス**: 全てのロックが解除される。
- **インタラクティブ分析**:
    -   属性フィルターのチェックボックスが有効化。
    -   グラフクリックによるドリルダウン（Cross-filtering）が可能。

---

## 5. データ構造とロジック

### 5.1 データストア
クライアントサイドで高速な再集計を行うため、回答データを正規化して保持する。

```javascript
// データ構造イメージ
{
  answers: [
    {
      id: "a001",
      submittedAt: "2026-01-30",
      attributes: { department: "営業", position: "課長" },
      responses: { q1: "満足", q2: ["機能", "価格"] }
    },
    // ...
  ]
}
```

### 5.2 集計ロジック
1.  **Filtering**: Global Filter 条件に合致する回答を抽出。
2.  **Grouping**:
    -   通常時: 設問ごとの回答数カウント。
    -   クロス集計時: (回答値, 軸の値) のペアでカウント。
3.  **Rendering**: Chart.js 用データセット生成。

## 6. 今後の拡張計画
- **Phase 1**: 新レイアウト、基本ロック機能、アップセルモーダルの実装。
- **Phase 2**: 実際のクロス集計ロジック、VSモードの実装。
- **Phase 3**: PDFレポート機能の実装。
