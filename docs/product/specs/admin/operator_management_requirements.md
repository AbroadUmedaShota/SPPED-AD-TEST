# オペレーター管理画面 要件定義書 (v1.2)

**文書バージョン:** 1.2
**作成日:** 2025年10月4日
**最終更新日:** 2025年10月30日
**作成者:** [Gemini]

**改訂履歴**

| バージョン | 改訂日 | 改訂内容 | 改訂者 |
| :--- | :--- | :--- | :--- |
| 1.2 | 2025/10/30 | エラーハンドリング、スコープ、データモデルの具体化、KPI計算式の追記 | [Gemini] |
| 1.1 | 2025/10/30 | 用語定義の明確化、要件の集約、データモデルの具体化、操作フローの具体化 | [Gemini] |
| 1.0 | 2025/10/04 | 初版作成 | [Gemini] |

---

## 1. 概要

### 1.1 目的
管理者（またはオペレーター管理者）が「オペレーター管理」画面 (`03_admin/operator-management.html`) を通じて、オペレーターの稼働状況をリアルタイムで把握し、新規オペレーターの招待、および過去の操作履歴を確認・管理するためのUIを定義する。

### 1.2 用語定義
| 用語 | 説明 | データモデル値 / 計算式 |
| :--- | :--- | :--- |
| **オペレーター権限** | オペレーターに付与される役割。 | `role` (e.g., `input-only`, `checker`, `admin`) |
| **オペレーター状態** | オペレーターの現在の稼働状況。 | `status` (e.g., `active`, `idle`, `suspended`) |
| **精度 (一致率)** | オペレーターが処理したデータの一致率。 | `(一致した項目数 / 全項目数) * 100` |

### 1.3 背景
BPOセンターで複数のオペレーターが同時稼働するため、状況サマリと一覧操作を行う画面が必要。モックに含まれる構造を正式要件として整理する。

### 1.4 スコープ
- KPIカード、オペレーター一覧テーブル（ページネーション、表示人数変更機能含む）、検索／フィルタ機能。
- 新規招待モーダル、収納式の最近の操作履歴セクション。
- 主要ボタンの動作およびアクセシビリティ要件。

**補足:** オペレーターグループの作成・編集・削除といった管理機能は、本要件定義の範囲外とする。

---

## 2. 画面構成

### 2.1 ヘッダー
- H1「オペレーター管理」と右側に `bg-secondary` の「オペレーター招待」ボタンを表示する。【F:03_admin/operator-management.html†L23-L29】

### 2.2 KPIカード
- 4枚のカード「稼働中」「待機中」「平均処理件数/日」「精度 (一致率)」を1列〜4列のレスポンシブグリッドで表示し、数値を `text-display-small` で強調する。
- 各KPIは「本日」のデータを表示する。期間選択機能は将来検討事項とする。

### 2.3 オペレーター一覧
- 「オペレーター一覧」カード内に検索フィールドとフィルタボタンを配置し、テーブルを提供する。
- テーブル列:
    - **氏名**: オペレーターの氏名。
    - **メール**: オペレーターのメールアドレス。
    - **権限**: オペレーターの権限（例: 「入力専任」「照合兼任」）。
    - **現在タスク**: 現在担当しているタスクの名称を表示する。タスクがない場合は「-」とする。
    - **本日完了**: 本日完了したタスクの件数。
    - **精度**: オペレーターのデータ入力精度（一致率）。
    - **状態**: オペレーターの現在の状態。状態に応じて色分けされたラベルで表示（例: `稼働中`=緑, `待機中`=黄, `停止中`=灰）。
    - **操作**: オペレーターに対するアクションボタン群。
- デフォルトは50名のオペレーターを表示し、それ以上になった場合はページネーションで切り替えを行う。表示人数はプルダウンで50/100/200件に変更可能とする。

### 2.4 最近の操作履歴
- 「最近の操作履歴」リストで日時・操作者・内容を時系列表示する。
- 画面右側に収納式で表示し、デフォルトは非表示とする。

---

## 3. 機能要件

### 3.1 検索・フィルタリング
- **検索フィールド**: 氏名・メールアドレスを対象とした部分一致検索を提供する。
- **フィルターモーダル**: 以下の項目による絞り込み機能を提供する。
    - **権限**: チェックボックスで複数選択可能。
    - **状態**: チェックボックスで複数選択可能。
    - **グループ**: 所属グループで絞り込み。
    - **タスク有無**: 「あり」「なし」のラジオボタンで選択。

### 3.2 オペレーター招待
- **招待モーダル**:
    - 招待するユーザーのメールアドレスを入力する。入力値はメール形式かリアルタイムでバリデーションする。
    - 付与する権限をプルダウンから選択する（「入力専任」「照合兼任」「管理者」）。
- **招待フロー**:
    - 「招待」ボタンクリックで招待メールを送信するAPIを呼び出す。
    - 成功時は「招待メールを送信しました」というメッセージをトーストで表示し、モーダル内のフォームをクリアする。
    - 失敗時は「招待メールの送信に失敗しました。時間をおいて再度お試しください」といったエラーメッセージをトーストで表示し、モーダルは閉じずにエラー内容を保持する。

### 3.3 オペレーター操作
- **詳細表示**:
    - 「詳細」ボタンクリックで、対象オペレーターの以下の情報を表示するサイドバーまたはモーダルを開く。
        - 基本情報（氏名、メール、権限、グループ）
        - 現在のステータスと稼働開始時刻
        - 本日のパフォーマンス（処理件数、精度）
        - 最近のタスク履歴（直近5件）
- **状態変更**:
    - **稼働停止**: 確認モーダル（例: 「[氏名]さんを稼働停止しますか？」）で「はい」を選択後、APIを呼び出しステータスを `suspended` に更新する。
    - **削除**: 確認モーダル（例: 「[氏名]さんの情報を完全に削除します。よろしいですか？」）で「はい」を選択後、APIを呼び出しオペレーター情報を削除する。
    - API呼び出しに失敗した場合は、「処理に失敗しました。時間をおいて再度お試しください」といったエラーメッセージをトーストで表示する。
- **タスク割当**:
    - 「割当」ボタンでタスク選択モーダルを開き、アサイン可能なタスクを一覧表示する。タスクを選択して割り当てる。

### 3.4 操作履歴
- 画面右側の収納式パネルに、直近10件の操作履歴（誰が、いつ、何をしたか）を時系列で表示する。

---

## 4. データモデル

### 4.1 オペレーターサマリー (summary)
| カラム名 | 型 | 説明 | 必須/任意 |
| :--- | :--- | :--- | :--- |
| `active` | `int` | 稼働中のオペレーター数 | 必須 |
| `idle` | `int` | 待機中のオペレーター数 | 必須 |
| `avgPerDay` | `float` | オペレーター一人あたりの平均処理件数/日 | 必須 |
| `accuracy` | `float` | オペレーターの精度 (一致率) | 必須 |

### 4.2 オペレーター情報 (operators)
| カラム名 | 型 | 説明 | 取りうる値の例 | 必須/任意 |
| :--- | :--- | :--- | :--- | :--- |
| `id` | `string` | オペレーターID | - | 必須 |
| `name` | `string` | 氏名 | - | 必須 |
| `email` | `string` | メールアドレス | - | 必須 |
| `role` | `string` | 権限 | `input-only`, `checker`, `admin` | 必須 |
| `currentTaskId` | `string` | 現在担当タスクのID | タスクがない場合は `null` | 任意 |
| `currentTaskName` | `string` | 現在担当タスクの名称 | タスクがない場合は `null` | 任意 |
| `todayCompleted` | `int` | 本日完了したタスク件数 | - | 必須 |
| `accuracy` | `float` | データ入力精度 (0.0-1.0) | - | 必須 |
| `status` | `string` | 現在の状態 | `active`, `idle`, `suspended` | 必須 |

### 4.3 招待情報 (invite)
| カラム名 | 型 | 説明 | 取りうる値の例 | 必須/任意 |
| :--- | :--- | :--- | :--- | :--- |
| `email` | `string` | 招待するメールアドレス | - | 必須 |
| `role` | `string` | 付与する権限 | `input-only`, `checker`, `admin` | 必須 |

### 4.4 操作履歴 (activityLogs)
| カラム名 | 型 | 説明 | 取りうる値の例 | 必須/任意 |
| :--- | :--- | :--- | :--- | :--- |
| `timestamp` | `string (ISO 8601)` | 操作日時 | `2025-10-30T10:00:00Z` | 必須 |
| `actor` | `string` | 操作者の氏名 | - | 必須 |
| `action` | `string` | 操作内容 | `operator.invited`, `operator.suspended` | 必須 |

---

## 5. 非機能要件
- **パフォーマンス**: オペレーター数5,000件のデータ量において、検索・フィルタリング結果の表示が1秒以内に完了すること。
- **アクセシビリティ**: 全ての操作がキーボードのみで完結できること。`aria-label` などを適切に付与し、スクリーンリーダーでの読み上げに対応すること。
- **UI/UX**: KPIカードは視覚的強調のためアイコンを使用するが、色覚特性に配慮し、数値とテキストのみで情報が伝わるように設計する。

---

## 6. 将来検討事項
- 稼働状況のリアルタイム更新（WebSocket連携）。
- シフト計画管理や休暇申請フローとの連携。
- CSVインポートによるオペレーターの一括招待機能。
- テーブルの列表示カスタマイズ機能。

---
以上
