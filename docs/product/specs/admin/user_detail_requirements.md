# 利用者詳細画面 要件定義書 (v1.0)

**文書バージョン:** 1.0  
**作成日:** 2025年10月4日  
**作成者:** [Gemini]

**改訂履歴**

| バージョン | 改訂日 | 改訂内容 | 改訂者 |
| :--- | :--- | :--- | :--- |
| 1.0 | 2025/10/04 | 初版作成 | [Gemini] |

---

## 1. 概要

### 1.1 目的
管理者が個別利用者の属性・契約情報・権限を確認・編集する「利用者詳細」画面 (`03_admin/user-detail.html`) のUIおよび機能要件を定義する。本画面ではユーザーの状態変更、通知設定、関連アンケートの一覧表示を行う。

### 1.2 背景
ユーザー管理画面から遷移した後に必要となる編集項目や履歴がモック内で提示されているが、要件として整理されていなかった。権限の更新やメモの登録など、運用チーム間での作業手順を統一するため本書を作成する。

### 1.3 スコープ
- ヘッダー・タイトル行と主要アクション（保存、停止、初期化等）。
- ステータス/KPIカード、基本情報フォーム、詳細設定折り畳み、操作履歴。
- 所有アンケート一覧テーブルの表示項目。

---

## 2. 画面構成

### 2.1 ヘッダーとアクション
- タイトル行左側にユーザーIDと氏名を表示し、右側に「一覧に戻る」「初期化メール再送」「アカウント停止」「変更を保存」ボタンを配置する。【F:03_admin/user-detail.html†L22-L40】
- ボタンはアクセス権に応じて表示制御できるようにし、`変更を保存` は `bg-secondary` で強調する。

### 2.2 ステータスサマリ
- 4つのカードを並列配置し、ステータス・契約プラン・管理フラグ・関連アンケート数を表示する。各カードは `border-outline-variant` と `shadow-sm` を持ち、必要に応じて更新ボタンを備える。【F:03_admin/user-detail.html†L41-L74】

### 2.3 基本情報フォーム
- 「基本情報」セクションに氏名・カナ・メール・電話・会社名・部署役職・内部メモを配置する。編集フォームは2列グリッドで、内部メモは全幅とする。【F:03_admin/user-detail.html†L75-L110】
- セクション下部に権限変更やパスワード初期化などの追加アクションボタンを配置する。【F:03_admin/user-detail.html†L111-L117】

### 2.4 詳細設定
- 3つの `<details>` ブロックを用意し、「請求・連絡先情報」「サービス設定」「操作履歴」を折り畳み表示する。【F:03_admin/user-detail.html†L118-L177】
- サービス設定では権限ロール、利用モジュールのマルチセレクト、通知設定チェックボックス、MFA/IP制限のトグルを提供する。【F:03_admin/user-detail.html†L145-L167】

### 2.5 所有アンケート一覧
- 下部に `aria-label="所有アンケートテーブル"` を持つテーブルを配置し、アンケート名・ステータス・会期・プラン・未処理タスク・操作列（詳細／タスクを見る）を表示する。【F:03_admin/user-detail.html†L178-L231】

---

## 3. 機能要件

### 3.1 編集と保存
- `変更を保存` ボタン押下時、基本情報・詳細設定の変更をまとめてAPI送信する。
- 入力値はクライアント側で必須チェック（氏名・メール・会社名）を実施し、エラー時は該当フィールドにメッセージを表示する。

### 3.2 通知アクション
- 「初期化メール再送」はメール送信APIを呼び出し、成功時にトースト通知を表示する。
- 「アカウント停止」は確認モーダルを経由し、ステータスカードの表示を更新する。

### 3.3 操作履歴
- 操作履歴 `<details>` 内には最新順で最大20件を表示し、ページングは不要。
- 自動処理・担当者操作を区別できるよう、本文内にラベルを記載する。

### 3.4 所有アンケート
- テーブル行の「詳細」ボタンで `survey-detail.html?surveyId=<id>` へ遷移する。
- 「タスクを見る」でデータ入力/照合管理画面へ適切なパラメータ付きでリンクする。

---

## 4. データモデル（例）
```json
{
  "user": {
    "id": "USR-0001284",
    "name": "田中 太郎",
    "status": "active",
    "plan": "pro",
    "flags": ["attention"],
    "relatedSurveys": 12,
    "profile": {
      "kana": "タナカ タロウ",
      "email": "t.tanaka@example.com",
      "phone": "03-1234-5678",
      "company": "株式会社アブロード",
      "departmentRole": "マーケティング部 / マネージャー",
      "internalMemo": "契約更新交渉中。10月第1週に再連絡予定。"
    },
    "billing": {
      "name": "株式会社アブロード 御中",
      "email": "billing@example.com",
      "zipcode": "150-0001",
      "address": "東京都渋谷区神宮前1-1-1"
    },
    "serviceSettings": {
      "role": "運用管理者",
      "modules": ["アンケート作成", "データ入力管理", "ダッシュボード"],
      "notifications": {
        "email": true,
        "slack": true,
        "webhook": false
      },
      "mfa": true
    }
  },
  "surveys": [
    {
      "id": "sv_0001_25022",
      "name": "展示会2025春アンケート",
      "status": "公開中",
      "period": "2025/03/10〜03/15",
      "plan": "Pro",
      "pendingTasks": "3件 (入力), 1件 (照合)"
    }
  ]
}
```

---

## 5. 非機能要件
- 保存処理は 3 秒以内で完了し、完了後にサクセストーストを表示する。
- 編集セクションはキーボード操作のみで遷移可能で、`<details>` の開閉状態は URL ハッシュなどで保持できるよう検討する。
- テーブルは横スクロール対応とし、列幅はレスポンシブで再配置しない。

---

## 6. 将来検討事項
- 操作履歴のフィルタリング（期間・種別）機能。
- 関連アンケートからのドリルダウンにおける権限チェック強化。
- 監査ログのエクスポートおよびユーザーへのメールテンプレート設定編集。
