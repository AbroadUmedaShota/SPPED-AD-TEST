# 月次変更履歴 (2025-11-18 〜 2025-12-18)

## 2025-12-18 (木)

- `surveyCreation.html` / `thankYouScreenSettings.html`
    - **画面推移アラートの誤検知修正**: アンケート作成画面の目次（TOC）をクリックした際、同一ページ内の移動であるにも関わらず「保存されていない変更があります」というアラートが表示される問題を修正しました。ハッシュ変更イベントの監視ロジックを見直し、内部リンク移動を除外するように変更しました。
    - **サンクス画面設定の保存ロジック**: 新規アンケート作成フローにおいて、サンクス画面の設定値が正しく初期化・保存されないケースがあったため、デフォルト値の適用と保存処理の順序を修正しました。
    - **数値表示の統一**: 入力フォームにおける数値（金額等）の表示形式を、開発環境の基準に合わせて小数点以下の桁数処理やカンマ区切りの仕様を統一しました。
- `index.html` (ダッシュボード)
    - **検索機能の不具合修正**: ダッシュボードの検索バーに「アンケートID」を入力しても該当するアンケートがヒットしないバグを修正しました。検索対象のフィールド定義を見直し、ID部分一致でも検索可能にしました。
- `02_dashboard/src/surveyDetailsModal.js` / `surveyDetailsModal.html`
    - **名刺データ化プラン表示の改修**: 詳細モーダル内の「名刺データ化」というラベルを、より具体的な「データ化項目プラン」に変更しました。また、内部値（`full`, `light`等）をそのまま表示するのではなく、設定ファイルに基づいて「フルデータ化」「ライトプラン」といった日本語の正式名称で表示するロジックを実装しました。
- `02_dashboard/src/tableManager.js`
    - **データ保存フローの改善**: アンケート一覧でデータを編集・保存する際、確認モーダルで「はい」を選択しても保存処理が中断される場合がある問題を修正しました。非同期処理の待機（await）漏れを解消し、確実に保存が完了してからUIが更新されるようにしました。
- `GEMINI.md`
    - **ルール更新**: 変更を加えた際は必ず `WEEKLY_CHANGELOG.md` を更新することをルールとして明文化しました。

## 2025-12-17 (水)

- `02_dashboard/src/invoiceDetail.js` / `invoice-detail.html`
    - **PDF白紙問題の解決**: 請求書PDFダウンロード時、2ページ目以降が白紙になる、または全体が白紙になるというクリティカルな問題を修正しました。
        - **修正内容**: `html2canvas` が画面外（`left: -10000px`など）の要素を正しくレンダリングできない仕様制限を回避するため、印刷用クローン要素を画面内（`top: 0, left: 0`）に配置しつつ `z-index` で最背面に隠す手法に変更しました。
    - **フッター位置の調整**: ページ番号（フッター）がコンテンツ（明細行）と重なる問題を解消するため、2ページ目以降のフッター位置を紙面下端から3mmの位置まで下げ、十分な余白を確保しました。
- `02_dashboard/modals/downloadOptionsModal.html` / `downloadOptionsModal.js`
    - **ダウンロード不可理由の可視化**: ダウンロードボタンがグレーアウト（非活性）されている際、ユーザーがその理由（期限切れ、未払い等）を把握できるように、ボタンホバー時にツールチップで具体的な理由を表示する機能を追加しました。
- `02_dashboard/src/tableManager.js` / `pager.js`
    - **スライディングウィンドウ式ページネーション**: アンケート一覧のページネーションを改善しました。
        - **変更前**: 固定のページ数表示、または全ページ表示。
        - **変更後**: 現在のページを中心に前後2ページ（計5ページ）を表示するスライディングウィンドウ方式を採用し、ページ数が多い場合でもレイアウトが崩れず、かつナビゲーションしやすいUIに変更しました。

## 2025-12-15 (月)

- `02_dashboard/modals/downloadExpiredModal.html` / `statusService.js`
    - **ダウンロード期限切れ対応**: ダウンロード有効期限（7日間など）を過ぎたアンケートをダウンロードしようとした際に、エラーではなく専用の「期限切れ通知モーダル」を表示するように実装しました。
    - **デモデータの拡充**: 開発およびテスト効率化のため、期限切れ状態や特殊なステータスを持つデモ用アンケートデータ（`sv_0001_99099.json`）を追加しました。

## 2025-12-14 (土)

- `docs/product/overview/00_PROJECT_OVERVIEW.md` / `specs/04_invoice_screen.md`
    - **要件定義書の更新**: 未定義のお礼メール設定を持つアンケートデータの取り扱いについて、仕様を明確化しドキュメントに追記しました。

## 2025-12-12 (木)

- `02_dashboard/src/invoiceList.js` / `invoiceDetail.js`
    - **請求書機能の安定性向上**: 請求書一覧および詳細機能において、APIサーバーがダウンしている場合でも閲覧ができるよう、ローカルのJSONファイルをフォールバックとして使用する機能を実装しました。
- `02_dashboard/invoice-detail.html`
    - **UI整理**: ブラウザ標準の印刷機能とPDFダウンロード機能の混同を避けるため、請求書詳細画面からブラウザ印刷ボタンを削除しました。
- `02_dashboard/modals/newSurveyModal.html`
    - **一貫性の向上**: 新規アンケート作成モーダルのフォントサイズやボタン配置などのスタイルを修正し、既存のアンケート詳細モーダルとのデザイン統一を行いました。

## 2025-12-08 (日)

- `02_dashboard/src/sidebar.js`
    - **サイドバーのアクティブ表示**: 管理画面において、現在表示しているページに対応するサイドバーのメニュー項目がハイライト（アクティブ表示）されない問題を修正しました。URLパス判定ロジックを修正し、現在のページが正しく強調表示されるようにしました。

## 2025-12-06 (金)

- `02_dashboard/src/main.js`
    - **コンソールエラー修正**: 存在しないDOM要素に対してイベントリスナーを付与しようとして発生していたJavaScriptエラーを修正しました。要素の存在チェックを追加することで、不要なエラーログの出力を抑制しました。

## 2025-12-05 (木)

- `03_admin/src/data_entry.js`
    - **データ参照パスの修正**: 管理画面のデータ入力機能において、参照するJSONデータのパス設定が誤っておりデータが読み込めない問題を修正しました。
- `docs/product/specs/admin/00_admin_requirements_design.md`
    - **管理者権限仕様の更新**: 管理者ロール（Super Admin / Operator）ごとのアクセス権限マトリクスを更新し、ドキュメントに反映しました。
    - **ドキュメント整理**: 検討資料として`data_management_review.md`を追加しました。

## 2025-11-23 (土)

- `docs/product/overview/action_tasks_2025-10.md`
    - **タスクリストの整理**: 10月〜11月のアクションプランと残タスクを整理し、ドキュメント化しました。
