# 画面要件定義書: SpeedAd - グループ編集画面 (v2.1)

**更新履歴**
- v2.1 (本日): パフォーマンス、アクセシビリティ、エラーハンドリング、データスキーマの項目を追加し、全体的に要件を詳細化。
- v2.0: 実装された内容に基づき、ドキュメントを全面的に更新。

## 1. 概要

本ドキュメントは、既存グループの情報を編集するための画面の、現在実装されている機能と将来的な拡張性を含めた要件を定義します。
グループ名や説明文の変更、メンバーの権限管理、メンバーの追加・削除、並び替え、およびメンバー詳細情報の閲覧機能を提供します。

## 2. 画面目的

- グループ管理者が、所属グループの情報を直感的かつ柔軟に更新できること。
- メンバーの追加・削除・権限変更を、明確なフィードバックのもとで確実に行えること。
- メンバーの表示順を、ドラッグ＆ドロップで視覚的に並べ替えられること。
- メンバーの詳細情報を、モーダルウィンドウで迅速に確認できること。
- 未保存の変更がある場合にユーザーに通知し、意図しないデータ損失を防ぐこと。

## 3. レイアウトとコンポーネント

### 3.1. 基本レイアウト

- **ヘッダー/サイドバー/フッター**: プロジェクト共通のコンポーネントを動的に読み込んで使用する。
- **メインコンテンツ**: `max-w-6xl` と `mx-auto` クラスを持つコンテナでラップされ、適切な左右の余白が確保されている。
- **パンくずリスト**: `ダッシュボード > グループ編集` という階層を静的に表示する。

### 3.2. グループ情報編集フォーム

- **UIスタイル**: 入力フィールドは「Raised Label」スタイルを採用し、常時ラベルが視認可能。
- **グループ名**: テキスト入力フィールド。必須項目であり、未入力の場合はエラーメッセージが表示される。
- **説明文**: テキストエリア。

### 3.3. メンバー管理セクション

#### 3.3.1. メンバー招待エリア
- **UI**: メンバー一覧の上部に、新しいメンバーを招待するための専用エリアを配置。
- **コンポーネント**: 「メールアドレス」入力フィールド、「権限」選択ドロップダウン、「招待する」ボタンで構成される。
- **ボタン**: 「招待する」ボタンは、プロジェクトのデザイン要件に準拠したセカンダリボタンのスタイルが適用されている。

#### 3.3.2. メンバー一覧
- **表示形式**: メンバーを**カード形式**で一覧表示する。
- **カード内要素**:
    - **左側**: ドラッグハンドル（アイコン）、アバター画像、氏名、会社名、メールアドレス。
    - **右側**: 権限変更用のドロップダウン、削除アイコンボタン。
- **マイクロインタラクション**:
    - **追加時**: 新しいメンバーカードは、リストに**フェードインしながら表示**される。
    - **削除時**: 削除されたカードは、**フェードアウトしながら**リストから消える。
    - **テキストの省略**: 氏名やメールアドレスが長過ぎる場合は、CSSの`text-overflow: ellipsis`で省略表示し、**マウスホバーでツールチップに全文を表示**する。

### 3.4. フッターアクションボタン
- **UI**: 画面下部の右端に「キャンセル」ボタンと「保存」ボタンを配置。
- **状態管理**: 「保存」ボタンは、ページ内に未保存の変更（Dirty State）がある場合にのみ活性化される。初期状態およびバリデーションエラー時は非活性状態となる。

### 3.5. メンバー詳細モーダル
- **トリガー**: メンバー一覧のカード本体（ボタンやセレクトボックス以外の領域）をクリック、またはキーボードでフォーカス中にEnterキーを押下するとモーダルが開く。
- **表示内容**: アカウントに登録されている全ての情報が表示される。（詳細は「9. データスキーマ定義」を参照）
- **操作**: ヘッダーの「×」アイコン、またはフッターの「閉じる」ボタンでモーダルを閉じることができる。

## 4. 機能要件

### 4.1. 状態管理 (Dirty State)
- グループ名、説明文、メンバーの権限、メンバーの追加・削除など、ページ内のデータに変更が加わると、ページは「Dirty State」（未保存状態）になる。
- この状態になると、「保存」ボタンが活性化される。
- この状態でページを離脱しようとすると、ブラウザ標準の警告ダイアログが表示され、誤操作によるデータ損失を防ぐ。

### 4.2. データ保存・キャンセル
- **保存**: 
    - **成功時**: 活性化された「保存」ボタンをクリックすると、変更内容がコンソールに出力され、「**グループ情報が更新されました**」という**成功トースト通知**が表示される。
    - **失敗時 (APIエラー)**: (将来的な実装) API通信が失敗した場合、「**更新に失敗しました。時間をおいて再度お試しください**」という**エラートースト通知**を表示する。Dirty Stateは維持され、「保存」ボタンは再試行のために活性化されたままとなる。
- **キャンセル**: 「キャンセル」ボタンをクリックした際、Dirty Stateであれば「変更を保存せずに終了しますか？」という確認モーダルが表示される。

### 4.3. メンバー管理
- **招待**: 「招待する」ボタンをクリックすると、入力されたメンバーがクライアントサイドで一覧に追加される。入力欄はクリアされ、連続での追加が可能。
- **並び替え**: ドラッグ＆ドロップによる並び替えは、クライアントサイドでの表示順の変更のみであり、サーバーには永続化されない。

## 5. 画面フロー

1.  **グループ編集画面**にアクセス。
2.  `group-edit.js`が初期化され、ダミーデータがフォームおよびメンバー一覧に描画される。
3.  ユーザーがグループ名やメンバーの権限などを編集 → ページが**Dirty State**になり、「保存」ボタンが**活性化**。
4.  **フロー分岐:**
    - **a) 保存する場合**: 「保存」ボタンをクリック → 成功トースト表示。
    - **b) キャンセルする場合**: 「キャンセル」ボタンをクリック → 確認モーダル表示 → 「はい」で離脱。
    - **c) メンバー詳細を確認する場合**: メンバーカードをクリック → **メンバー詳細モーダル**表示 → 閉じるボタンでモーダルを閉じる。
    - **d) ページ離脱を試みる場合**: ブラウザの戻るボタンなど → **ページ離脱警告**が表示される。

## 6. データ連携

- **読み込み/書き込み**: 全てのデータは`group-edit.js`内に定義された`mockGroup`オブジェクトから取得・更新される。

## 7. パフォーマンス考慮事項

- **リストの仮想化**: (将来的な実装) グループのメンバー数が50件を超える場合、全件を一度にDOMに描画するとパフォーマンスが低下する可能性がある。そのため、`Intersection Observer` APIを利用した無限スクロールや、リスト仮想化ライブラリの導入を検討し、表示領域外のDOM描画を抑制する。

## 8. アクセシビリティ (A11y)

- **キーボードナビゲーション**: 
    - `Tab`キーで、ページ内の全てのインタラクティブ要素（入力欄、ボタン、メンバーカードなど）間を論理的な順序で移動できること。
    - メンバー一覧でカードにフォーカスがある状態で、`Enter`キーを押下すると、メンバー詳細モーダルが開くこと。
- **ARIA属性**: 
    - 全てのボタン、特に入力欄に紐づかないアイコンボタンには、`aria-label`属性でその役割を明記すること。（例: 削除ボタンに`aria-label="メンバーを削除"`）
- **モーダルのフォーカス管理**: メンバー詳細モーダルが開いている間は、`Tab`キーによるフォーカスがモーダル内の要素に限定（フォーカストラップ）され、背景のページ要素に移動しないこと。

## 9. データスキーマ定義

### 9.1. Member オブジェクト

| プロパティ名   | データ型 | 必須 | 説明                                   |
| :------------- | :------- | :--- | :------------------------------------- |
| `email`        | `String` | ✅   | メンバーの一意なIDとなるメールアドレス。 |
| `role`         | `String` | ✅   | 権限。`'admin'` または `'member'`。      |
| `name`         | `String` | ✅   | 氏名。                                 |
| `company`      | `String` | ✅   | 所属会社名。                           |
| `department`   | `String` | ⬜️   | 部署名。                               |
| `title`        | `String` | ⬜️   | 役職名。                               |
| `phone`        | `String` | ⬜️   | 電話番号。                             |
| `postalCode`   | `String` | ⬜️   | 郵便番号。                             |
| `address`      | `String` | ⬜️   | 住所。                                 |
