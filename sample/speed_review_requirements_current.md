# 画面要件定義書: SpeedAd - SPEEDレビュー画面 (現状版)

## 1. 概要

本ドキュメントは、SpeedAdサービスのSPEEDレビュー画面の**現状の要件**を定義する。
この画面は、ユーザーがアンケート回答データを効率的に確認、検索、管理するためのインターフェースとして機能する。

## 2. 画面目的

- ユーザーが特定のアンケートに紐づく回答データを一覧で把握できること。
- 回答データをキーワードで検索し、必要な情報を迅速に見つけられること。
- 回答の詳細情報を確認し、必要に応じて編集できること。
- 大量の回答データでも、ページネーションにより快適に閲覧できること。

## 3. レイアウトとコンポーネント

### 3.1. 基本レイアウト

- **ヘッダー**: 画面上部に固定。ブランドロゴ、ユーザー情報、グローバルナビゲーション（テーマ切替など）を配置する。
- **サイドバー**: 画面左側に配置。主要機能へのナビゲーションリンク、グループ管理機能を提供する。
- **メインコンテンツ**: 画面中央の主要エリア。アンケート一覧と関連する操作パネルを配置する。
- **ツールボックス**: 画面右側に配置。キーワード検索、日時絞り込み、グラフ化ボタン、およびテーブル内に表示する設問の視覚的選択機能を提供する。
- **フッター**: 画面下部に配置。補足的なリンク（利用規約、プライバシーポリシー等）やコピーライト情報を表示する。

### 3.2. レスポンシブ挙動

- **デスクトップ (XL, >1280px)**: サイドバーはデフォルトで折りたたまれており（アイコンのみ表示）、ホバーすることで展開される。ツールボックスは常に表示される。
- **タブレット (LG, 1024px - 1279px)**: サイドバーは常に展開された状態で表示される。ツールボックスは常に表示される。
- **モバイル (<1023px)**: サイドバーはデフォルトで非表示。ヘッダーのハンバーガーメニューをタップすることで、画面左からオーバーレイとして表示される。ツールボックスは、画面下部または別のモーダルとして表示されることを検討する（詳細設計で決定）。

### 3.3. モーダルウィンドウ (`reviewDetailModal`)

- **目的**: 特定のアンケート回答の詳細情報を表示する。
- **表示内容**:
    - **名刺情報セクション**: 回答に紐づく名刺の詳細情報（氏名、会社名、連絡先など）を動的に表示。
    - **アンケート回答セクション**: 回答者が入力したアンケートの全設問と回答内容を動的に表示。
- **操作**: 「閉じる」ボタンと「編集する」ボタンを配置。
- **データマッピング**: モーダル内の表示項目は、「6. データ連携」で定義された結合済みデータオブジェクトから取得する。
    | 表示セクション | 表示項目 | データソースのキー |
    | :--- | :--- | :--- |
    | **名刺情報** | 氏名 | `businessCard.name` |
    | | 会社名 | `businessCard.company` |
    | | 部署 | `businessCard.department` |
    | | 役職 | `businessCard.title` |
    | | メール | `businessCard.email` |
    | | 住所 | `businessCard.address` |
    | **アンケート回答** | (質問1のテキスト) | `survey.questionGroups[0].questions[0].text` |
    | | (質問1の回答) | `answers[0].value` |
    | | (質問2のテキスト) | `survey.questionGroups[0].questions[1].text` |
    | | (質問2の回答) | `answers[1].value` |
    | | ... | ... |

## 4. 機能要件

### 4.1. 回答データの表示と管理

- **初期表示**: 画面ロード時、URLのクエリパラメータ (`?surveyId=...`) に基づき、「6. データ連携」で詳述するロジックでデータを取得・結合し、テーブルに表示する。
- **ページネーション**: 結合・フィルタリング済みのデータ配列に対して、ページネーションを適用する。
    - **表示件数オプション**: 25, 50, 100, 200件。デフォルトは25件。
- **詳細表示**: テーブルの**各行をクリック**することで、該当する回答の詳細情報がモーダルで表示される。アクション列の「詳細」ボタンは存在しない。

### 4.2. ツールボックス機能

- **キーワード検索**:
    - **ロジック**: 入力されたキーワードに対し、以下のフィールドを対象に部分一致・大文字小文字無視で検索を実行する。
    - **対象フィールド**:
        - `businessCard.name`
        - `businessCard.company`
        - `businessCard.department`
        - `businessCard.title`
        - `businessCard.email`
        - 各回答 (`answers[n].value`)
- **日時絞り込み**:
    - 特定の日付または期間で回答データを絞り込む機能を提供する。
- **グラフ化ボタン**:
    - クリックすると、グラフ化ページへの遷移を促す（現在はアラート表示）。
- **テーブル表示設問の選択**:
    - テーブル内に表示する設問を、プルダウン形式ではなく、視覚的な選択肢（例: ボタン、チェックボックスリストなど）で選択できるようにする。
    - 選択された設問の回答がテーブルの該当列に表示される。

## 5. 画面フロー

...(既存の画面フローは変更なし。ここでは省略)...

## 6. データ連携

SPEEDレビュー画面のデータは、複数のJSONファイルをクライアントサイドで結合して生成される。

### 6.1. データソース

- **アンケート設問**: `data/surveys.json`
- **回答データ**: `data/survey-answers.json`
- **名刺データ**: `data/business-cards.json`

### 6.2. データ結合ロジック

1.  **起点**: 画面ロード時にURLから `surveyId` を取得する。
2.  **アンケート特定**: `surveys.json` から `surveyId` に一致するアンケートオブジェクト (`survey`) を取得する。これには設問情報が含まれる。
3.  **回答データ取得**: `survey-answers.json` から、同じ `surveyId` を持つ全ての回答オブジェクトの配列 (`answerSet`) を取得する。
4.  **名刺情報結合**: `answerSet` の各回答オブジェクト (`answer`) について、以下の処理を行う。
    - `answer.cardId` をキーとして `business-cards.json` を検索し、一致する名刺オブジェクト (`businessCard`) を見つける。
    - 元の `answer` オブジェクトに、見つけた `businessCard` をプロパティとして追加する (例: `answer.businessCard = businessCard`)。
5.  **最終データ**: 上記の処理を経て、名刺情報がネストされた回答オブジェクトの配列が完成する。これが、画面のテーブル描画、検索、モーダル表示の元データとなる。

**最終的なデータオブジェクト構造（1件分）の例:**
```json
{
  "answerId": "ans-001",
  "surveyId": "survey-123",
  "timestamp": "2025-07-20T10:30:00Z",
  "cardId": "card-abc",
  "answers": [
    { "questionId": "q1", "value": "製品A" },
    { "questionId": "q6", "value": "High" }
  ],
  "businessCard": {
    "cardId": "card-abc",
    "name": "山田 太郎",
    "company": "株式会社テスト",
    "email": "yamada@example.com",
    ...
  }
}
```

## 7. 非機能要件

- **パフォーマンス**: 数千件以上の回答データでも、クライアントサイドでの結合・検索・ページネーションが1秒以内に応答すること。データ量が多い場合は、Web Workerの利用を検討する。

...(その他の非機能要件は変更なし)...